# TCP/IP 四层模型

- 什么是 OSI 七层模型
- 什么是 TCP/IP 四层模型
- 应用层和传输层有哪些协议？
- 如何理解 TCP/IP 四层模型？



## OSI 模型 

### [wiki](https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B)

开放式系统互联通信参考模型（Open System Interconnection Reference Model，缩写 OSI），简称 OSI 模型。

由国际标准化组织于 1984 年提出。、

### 应用层

Application Layer，提供为应用软件而设的接口，以设置与另一应用软件之间的通信。

例如：HTTP、HTTPS、FTP、TELNET、SSH、SMTP、POP3 等。

### 表示层

Presentation Layer，把数据转换为能与接受者的系统格式兼容并适合传输的格式。

### 会话层

Session Layer，负责把在数据传输中设置和维护计算机网络中两台计算机之间的通信连接。

### 传输层

Transport Layer，把传输表头（TH）加至数据以形成数据包。传输表头包含了所使用的协议等发送信息。

例如：TCP、UDP 等。

### 网络层

Network Layer，决定数据的路径选择和转寄，将网络表头（NH）加至数据包，以形成分组。

网络表头包含了网络数据，例如：互联网协议（IP）等

### 数据链路层

Data Link Layer，负责网络寻址、错误侦测和改错。当表头和表尾被加至数据包时，会形成帧。

数据链表头（DLH）是包含了物理地址和错误侦测及改错的方法。

数据链表尾（DLT）是一串指示数据包末端的字符串。例如：以太网、无线局域网（Wi-Fi）和通用分组无线服务（GPRS）等

### 物理层

Physical Layer，在局部局域网上传送数据帧（data frame），它负责管理计算机通信设备和网络媒体之间的互通。

包括了针脚、电压、线缆规范、集线器、中继器、网卡、主机适配器等。



> 分成了这么多层，很多东西没什么用，分完了发现这一层的东西在另一层体现出来，比如表示层和会话层就被废弃了。



## TCP/IP 四层模型

> 一个故事：小白和小黑是两个家族的继承人，每年两家都会致信问候~
>
> **小白**
>
> 大家族规矩真多，开黑打个游戏写信还要写一堆敬语
>
> 尊敬的小黑：
>
> ​	代表我和我家向您和您的家族献上新年的问候。
>
> ​	春节来我家一起组队开黑。
>
> ​	......
>
> ​	您最诚挚的好友
>
> ​	小白
>
> **管家A**
>
> 大家族需要有大家族的规矩，我需要先给黑家的管家B通通气。
>
> A：我们家要给你们家发信了，收到请回答。
>
> B：收到，你发吧，收到请回答。
>
> A：收到
>
> 对了，黑家门牌号是多少，需要写在信封上。
>
> **邮差**
>
> 黑家的地址和小区名是多少？我写信封上。
>
> **邮筒**
>
> 信封的尺寸不能超过 7 存，大了放不进去，另外别忘了贴邮票。



从上面的故事中可以看到通信是很规范正式的，需要遵循一定的格式和规矩（尊敬的xxx........最诚挚的xxx）

当然对方收到信之后也会有正式的信回复过来。

之后，小白少爷只负责写信，表达他邀请的意思，后面的琐事（发信）交给管家。

管家不是直接发信的，需要先联系对方家族，万一对方没信了呢？是吧？（比如灭门了）所以需要发消息并收到回信。

然后对方门牌号什么的需要管家写到信封上，之后的事情交给邮差。

邮差就需要填写对方的详细地址比如小区名字什么的。

最后邮差塞信到邮筒，当然信要有合适的大小。

最后最后，别忘了交网费，没通网你联系个锤子。



### 应用层

> 写信人层，规范小白写信内容，只负责数据内容。

应用层是大多数普通与网络相关的程序为了通过网络与其他程序通信所使用的层。这个层的处理过程是应用特有的；

数据从网络相关的程序以这种应用内部使用的格式进行传送，然后被编码成标准协议的格式。

每一个应用层协议一般都会使用到传输层协议 TCP 和 UDP 协议之一：

运行在 TCP 协议上的协议：

1. HTTP（80 端口），主要用于普通浏览。
2. HTTPS（443 端口），HTTP 协议的安全版本。
3. FTP（20 和 21 端口），由名知义，用于文件传输。
4. POP3（110 端口），收邮件用。
5. SMTP（25 端口），用来发送电子邮件。
6. SSH（22 端口），用于加密安全登陆用。

运行在 UDP 协议上的协议：

1. DHCP（67 端口，动态主机配置协议），动态配置 IP 地址。

其他：

1. DNS（Domain Name Service，域名服务），用于完成地址查找，邮件转发等工作（运行在 TCP 和 UDP 协议上）。
2. SNMP（Simple Network Management Protocol，简单网络管理协议），用于网络信息的收集和网络管理。
3. ARP（Address Resolution Protocol，地址解析协议），用于动态解析以太网硬件的地址。



### 传输层

> 管家层，接收规范好的内容，确定能够可靠地抵达对方。添加门牌号（端口号）
>
> 继承人发给对方继承人的信，你不能发给佣人是吧，所以要确定端口号。

解决诸如端到端的可靠性（数据是否已经达到目的地？）保证数据按照正确的顺序到达这样的问题。TCP、UDP 都是传输层协议。



### 网络层

> 邮差，知道这封信发给谁，加上 IP 地址，就可以寄信了。

解决在一个单一网络上传输数据包的问题，IP 协议是网络层协议。



### 数据链路层

> 底层和网络发送数据相关的东西。0101010 这种数据流。

它是数据包从一个设备的网络层传输到另外一个设备的网络层的方法。这个过程能够在网卡的软件驱动程序中控制或者专用芯片中控制。这将完成如添加报头准备发送、通过实体介质实际发送这样一些数据链路功能。另一端，链路层将完成数据帧接收、去除报头并且将接收到的包传到网络层。



## 总结

为什么要分层？因为这样逻辑分层使得传输过程更加清晰了起来。

比如写一个应用的时候或者使用 HTTP 协议处理数据的时候，就不需要再去关注数据到底能不能发成功，发给谁。只需要将信的格式规范好，双方的管家是不需要作为家族继承人的你去关注的，这就是分层的好处~