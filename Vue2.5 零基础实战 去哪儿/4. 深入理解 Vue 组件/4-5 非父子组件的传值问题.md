# 非父子组件间的传值

一个网页可以拆分为不同的组件，从而构成一个组件树。



父组件通过 props 向子组件传值。

子组件通过事件触发向父组件传值。

假设 3 层组件向 1 层 组件传值，那么就必须通过中间层进行传值。

假设兄弟层之间要进行通信，就很复杂了， Vue 的官方定义是轻量级的视图层框架，当我们的项目中出现复杂的数据传递的时候，光靠 Vue 是不行的，所以我们需要引进其他的工具或者是设计模式，来帮我们解决复杂的组件传值问题。

非父子组件传值：组件间不存在父子关系。一般来说两种方式：

- 官方提供的数据层框架：vuex，使用有难度
- 使用发布订阅的设计模式（总线机制）



### 基础模板

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <child></child>
        <child></child>
    </div>


    <script>

        Vue.component('child', {
            template: '<div >Child</div>',

        })

        var vm = new Vue({
            el: '#app',
        })
    </script>
</body>
</html>  
```

### BUS/总线/观察者/发布订阅模式

将一个简单的 vue 实例赋值给 Vue.prototype.bus 属性，只要我们以后去调用 new Vue( ) 或者创建组件的时候，每个组件上都有 bus 这个属性，因为每个实例都是通过 Vue() 类实现的，都指向同一个 Vue()。

```
Vue.prototype.bus = new Vue()
```

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <child content="PHP"></child>
        <child content="JAVA"></child>
    </div>


    <script>

        Vue.prototype.bus = new Vue()

        Vue.component('child', {
            props: {
                content: String
            },
            template: '<div @click="handleClick">{{ content }}</div>',
            methods: {
                handleClick: function() {
                    this.bus.$emit('change', this.content);
                }
            }
        })

        var vm = new Vue({
            el: '#app',
        })
    </script>
</body>
</html>  
```

this.bus 就是挂载的总线，触发事件后内容传给，这个组件触发其他的子组件要监听：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <child content="PHP"></child>
        <child content="JAVA"></child>
    </div>


    <script>

        Vue.prototype.bus = new Vue()

        Vue.component('child', {
            props: {
                content: String
            },
            template: '<div @click="handleClick">{{ content }}</div>',
            methods: {
                handleClick: function() {
                    this.bus.$emit('change', this.content);
                }
            },
            mounted: function() {
                this.bus.$on('change', function(msg) {
                    alert(msg)
                });
            }
        })

        var vm = new Vue({
            el: '#app',
        })
    </script>
</body>
</html>  
```

我们可以看到点击一次 div 弹出两次弹窗，因为每个弹窗都监听了 change 事件：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <child content="PHP"></child>
        <child content="JAVA"></child>
    </div>


    <script>

        Vue.prototype.bus = new Vue()

        Vue.component('child', {
            props: {
                content: String
            },
            template: '<div @click="handleClick">{{ content }}</div>',
            methods: {
                handleClick: function() {
                    this.bus.$emit('change', this.content);
                }
            },
            mounted: function() {
                this.bus.$on('change', function(msg) {
                    this.content = msg;
                });
            }
        })

        var vm = new Vue({
            el: '#app',
        })
    </script>
</body>
</html>  
```

这时候点击没有发生变化，因为 this 的作用域发生了变化，我们这样呢修改：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <child content="PHP"></child>
        <child content="JAVA"></child>
    </div>


    <script>

        Vue.prototype.bus = new Vue()

        Vue.component('child', {
            props: {
                content: String
            },
            template: '<div @click="handleClick">{{ content }}</div>',
            methods: {
                handleClick: function() {
                    this.bus.$emit('change', this.content);
                }
            },
            mounted: function() {
                var this_ = this
                this.bus.$on('change', function(msg) {
                    this_.content = msg;
                });
            }
        })

        var vm = new Vue({
            el: '#app',
        })
    </script>
</body>
</html>  
```

然后我们对代码进行优化：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <child content="PHP"></child>
        <child content="JAVA"></child>
    </div>


    <script>

        Vue.prototype.bus = new Vue()

        Vue.component('child', {
            props: {
                content: String
            },
            data: function() {
                return {
                    selContent: this.content
                }
            },
            template: '<div @click="handleClick">{{ selContent }}</div>',
            methods: {
                handleClick: function() {
                    // alert(this.selContent);
                    this.bus.$emit('change', this.selContent);
                }
            },
            mounted: function() {
                var this_ = this
                this.bus.$on('change', function(msg) {
                    // alert(msg)
                    this_.selContent = msg
                })
            }
        })

        var vm = new Vue({
            el: '#app'
        })
    </script>
</body>
</html>  
```

