## 如何使用 is 标签解决页面渲染中的小 BUG

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Vue 实例生命周期函数</title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <table>
            <tbody>
                <row></row>
                <row></row>
                <row></row>
                <row></row>
            </tbody>
        </table>
    </div>


    <script>

        Vue.component('row', {
            template: '<tr><td>this is a row.</td></tr>'
        })

        var vm = new Vue({
            el: '#app',
            data: {
                
            }
        })
    </script>
</body>
</html>  
```

可以看到 <row> 标签跑到了 <tbody> 的外部，没有别包裹，并且和 <table> 同级。

原因：H5 的规范里 table->tbody->tr，但是我们现在使用组件，浏览器在解析 row 的时候就会出问题。

解决：借助 Vue 提供的 is 属性：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Vue 实例生命周期函数</title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <table>
            <tbody>
                <tr is="row"></tr>
                <tr is="row"></tr>
                <tr is="row"></tr>
                <tr is="row"></tr>
            </tbody>
        </table>
    </div>


    <script>

        Vue.component('row', {
            template: '<tr><td>this is a row.</td></tr>'
        })

        var vm = new Vue({
            el: '#app',
            data: {
                
            }
        })
    </script>
</body>
</html>  
```



## 子组件定义 data 必须是函数

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <table>
            <tbody>
                <tr is="row"></tr>
                <tr is="row"></tr>
                <tr is="row"></tr>
                <tr is="row"></tr>
            </tbody>
        </table>
    </div>


    <script>

        Vue.component('row', {
            data: {
                content: 'this is a row.'
            }
            template: '<tr><td>{{ row }}</td></tr>'
        })

        var vm = new Vue({
            el: '#app',
            data: {
                
            }
        })
    </script>
</body>
</html>  
```

将子组件的内容渲染进模板中，发现上面的代码是无效的。

```
Vue.component('row', {
    data: function() {
        return {
            content: 'this is content.'
        }
    },
    template: '<tr><td>{{ content }}</td></tr>'
})
```

根组件里面定义 data 是没有问题的，但是在非根组件里面要求 data 后面的值必须是个函数。

设计原因：一个子组件会被调用多次，每个子组件的数据不希望和其他子组件冲突（每个子组件都应该有自己的数据），通过一个函数返回一个对象的目的就是为了每个子组件都拥有独立的数据存储，这样就不会出现多个子组件互相影响的现象。



## ref

Vue 不建议我们去直接操作 DOM， 但是在处理极其复杂的动画效果，光靠 Vue 的数据绑定是不够的。

我们通过 ref 引用的方式去获取 DOM、操作 DOM。

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <div 
            ref='hello'
            @click="handleClick">
            Hello World!
        </div>
    </div>


    <script>
        var vm = new Vue({
            el: '#app',
            data: {
                
            },
            methods: {
                handleClick: function() {
                    // 整个 Vue 实例里面所有的引用
                    alert(this.$refs.hello.innerHTML);
                }
            }
        })
    </script>
</body>
</html>  
```

看起来和组件没有关系，我们现在这个 div 是个标签，通过 ref 获取到的是一个 DOM 元素，如果这是一个组件，组件上面的 ref 获取到的是组件的引用：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head> 
<body>
    <div id="app">
        <counter ref="one" @change="handleChange"></counter>
        <counter ref="two" @change="handleChange"></counter>
        <div>
            {{ total }}
        </div>
    </div>


    <script>

        Vue.component('counter', {
            data: function() {
                return {
                    number: 0
                }
            },
            template: '<div @click="handleClick">{{ number }}</div>',
            methods: {
                handleClick: function() {
                    this.number ++;
                    this.$emit('change')
                }
            }
        })


        var vm = new Vue({
            el: '#app',
            data: {
                total: 0
            },
            methods: {
                handleChange: function() {
                    this.total = this.$refs.one.number + this.$refs.two.number;
                }
            }
        })
    </script>
</body>
</html>  
```

