## 前端组件化

我们将页面进行分割，分别书写页面逻辑。

合理地分离组件，我们可以将一个大型的项目通过简易拼接完成页面。





## 组件化思想改造 TodoList



### 全局组件

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>TodoList</title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head>
<body>
    <div id="app">
        <input type="text" v-model="inputValue">
        <button @click="handleBtnClick">提交</button>
        <ul>  
            <todo-item 
                v-bind:content="item"
                v-for="item in list"></todo-item>
        </ul>
    </div>


    <script>

        Vue.component("TodoItem", {
            props: ['content'],
            template: "<li>{{ content }}</li>"
        })

        var app = new Vue({
            el: '#app',
            data: {
                list: [],
                inputValue: ''
            },
            methods: {
                handleBtnClick: function() {
                    this.list.push(this.inputValue)
                    this.inputValue = ''
                }
            }
        })
    </script>
</body>
</html>
```

定义了一个全局组件 TodoItem，通过 list 决定循环输出多少个组件，同时把每个 list 内容通过 v-bind 语法借助 content 变量传给了 todoItem 子组件，如果想用父组件传进来的数据，一定要在 props 里定义 content 来接收数据，然后我们就可以在 template 中使用 props 数据。



### 局部组件

下面我们来定义定义局部组件：

```html
<script>

    var TodoItem = {
        props: ['content'],
        template: "<li>{{ content }}</li>"
    }

    var app = new Vue({
        el: '#app',
        data: {
            list: [],
            inputValue: ''
        },
        components: {
            TodoItem: TodoItem
        },
        methods: {
            handleBtnClick: function() {
                this.list.push(this.inputValue)
                this.inputValue = ''
            }
        }
    })
</script>
```

把 TodoItem 注册到 Vue 实例中，原来叫 TodoItem，在实例中仍然叫 TodoItem。



### 组件改造回顾

我们将页面的内容进行封装到一个单独的组件，外界传递的数据如果要接收的话就把它定义到 props 中，template 指的是子组件的一个模板，用这个组件标签最终会被 template 中的内容替换掉。





## 简单的组件间传值

父组件向子组件传值：

通过 v-bind 和 props 接收外部传递进来的数据，如以上代码。

子组件向父组件传值：

我们先在子组件创建一个 click 方法：

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>TodoList</title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head>
<body>
    <div id="app">
        <input type="text" v-model="inputValue">
        <button @click="handleBtnClick">提交</button>
        <ul>  
            <todo-item 
                v-bind:content="item"
                v-for="item in list">
            </todo-item>
        </ul>
    </div>


    <script>

        var TodoItem = {
            props: ['content'],
            template: "<li v-on:click='handleItemClick'>{{ content }}</li>",
            methods: {
                handleItemClick: function() {
                    alert('click');
                }
            }
        }

        var app = new Vue({
            el: '#app',
            data: {
                list: [],
                inputValue: ''
            },
            components: {
                TodoItem: TodoItem
            },
            methods: {
                handleBtnClick: function() {
                    this.list.push(this.inputValue)
                    this.inputValue = ''
                }
            }
        })
    </script>
</body>
</html>
```

下面我们通过 $emit() 方法来监听 delete() 方法

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>TodoList</title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head>
<body>
    <div id="app">
        <input type="text" v-model="inputValue">
        <button @click="handleBtnClick">提交</button>
        <ul>  
            <todo-item 
                v-bind:content="item"
                v-for="item in list"
                v-on:delete="handleBtnDelete">
            </todo-item>
        </ul>
    </div>


    <script>

        var TodoItem = {
            props: ['content'],
            template: "<li v-on:click='handleItemClick'>{{ content }}</li>",
            methods: {
                handleItemClick: function() {
                    this.$emit("delete");
                }
            }
        }

        var app = new Vue({
            el: '#app',
            data: {
                list: [],
                inputValue: ''
            },
            components: {
                TodoItem: TodoItem
            },
            methods: {
                handleBtnClick: function() {
                    this.list.push(this.inputValue)
                    this.inputValue = ''
                },
                handleBtnDelete: function() {
                    alert('delete');
                }
            }
        })
    </script>
</body>
</html>
```

然后我们来改变子组件完成打印下标：

我们先在子组件上绑定一个 id 来存储它的所在数组下标，

然后在 v-for 标签内添加参数 index

接着在子组件中的 props 新注册一个元素 id，handleItemClick() 中的 $emit() 里面传入 this.id，

这样我们就把子组件的下标值传给了父组件的 handleBtnDelete 方法

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>TodoList</title>
    <link rel="stylesheet" href="">
    <script src="https://cdn.bootcss.com/vue/2.5.17/vue.js"></script>
</head>
<body>
    <div id="app">
        <input type="text" v-model="inputValue">
        <button @click="handleBtnClick">提交</button>
        <ul>  
            <todo-item 
                v-bind:content="item"
                v-bind:id="index"
                v-for="(item, index) in list"
                v-on:delete="handleBtnDelete">
            </todo-item>
        </ul>
    </div>


    <script>

        var TodoItem = {
            props: ['content', 'id'],
            template: "<li v-on:click='handleItemClick'>{{ content }}</li>",
            methods: {
                handleItemClick: function() {
                    this.$emit("delete", this.id);
                }
            }
        }

        var app = new Vue({
            el: '#app',
            components: {
                TodoItem: TodoItem
            },
            data: {
                list: [],
                inputValue: ''
            },
            methods: {
                handleBtnClick: function() {
                    this.list.push(this.inputValue)
                    this.inputValue = ''
                },
                handleBtnDelete: function(i) {
                    alert(i);
                }
            }
        })
    </script>
</body>
</html>
```

使用 splice() 方法来删除指定的元素， i 是开始下标，k 是删除个数

```html
		var app = new Vue({
            el: '#app',
            components: {
                TodoItem: TodoItem
            },
            data: {
                list: [],
                inputValue: ''
            },
            methods: {
                handleBtnClick: function() {
                    this.list.push(this.inputValue)
                    this.inputValue = ''
                },
                handleBtnDelete: function(i) {
                    this.list.splice(i, 1)
                }
            }
        })
```

