<html>
<head>
  <title>1.11 -- 渲染列表数据...</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1261"/>
<h1>1.11 -- 渲染列表数据...</h1>

<div>
<span><div>列表数据在前端非常常见, 我们经常要处理这种类型的数据, 例如文章列表, 评论列表, 用户列表, 一个前端工程师几乎每天都需要跟列表数据打交道.</div><div><br/></div><div>React.js 当然也允许我们处理列表数据, 但在使用 React.js 处理列表数据的时候, 需要掌握一些规则.</div><div><br/></div><div><b>渲染存放 JSX 元素的数组</b></div><div><br/></div><div>假设我们有这么一个用户列表数据, 存放在一个数组当中:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">const users = [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Jerry', age: 21, gender: 'male' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Tomy', age: 22, gender: 'male' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Lily', age: 19, gender: 'female' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Lucy', age: 20, gender: 'female' }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">]</span></div></div><div><br/></div><div>如果现在把这个数组里面的数据渲染到页面上要怎么做? 开始之前要补充一个知识. 之前说过 JSX 的表达式插入 {} 里面可以放人和数据, 如果我们往 {} 里面放一个存放 JSX 元素的数组会怎么样?</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Index extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        {[</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;React.js &lt;/span&gt;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;is &lt;/span&gt;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;good&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        ]}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ReactDOM.render(</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;Index /&gt;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  document.getElementById('root')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">)</span></div></div><div><br/></div><div>我们往 JSX 里面塞了一个数组, 这个数组里面放了一些 JSX 元素 (其实就是 JavaScript 对象). 到浏览器当中, 你在页面上回看到:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div> React.js is good.</div></div><div><br/></div><div>审查一下元素, 看看会发生什么:</div><div><br/></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">React.js 把插入表达式数组里面的每一个 JSX 元素一个个罗列下来, 渲染到页面上, 所以这里有个关键点: 如果你往 {} 放一个数组, React.js 会帮你把数组里面一个个元素罗列并渲染出来.</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">使用 map 渲染列表数据</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">知道这一点以后你就可以知道怎么用循环把元素渲染到页面上: 循环上面用户数组里面的每一个用户, 为每个用户数据构建一个 JSX, 然后把 JSX 放到一个新的数组里面, 再把新的数组插入啊render 方法的 JSX 里面. 看看代码怎么写:</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">const users = [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Jerry', age: 21, gender: 'male' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Tomy', age: 22, gender: 'male' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Lily', age: 19, gender: 'female' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Lucy', age: 20, gender: 'female' }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Index extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const usersElements = [] // 保存每个用户渲染以后 JSX 的数组</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    for (let user of users) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      usersElements.push( // 循环每个用户，构建 JSX，push 到数组中</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;div&gt;姓名：{user.username}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;div&gt;年龄：{user.age}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;div&gt;性别：{user.gender}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;hr /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div&gt;{usersElements}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ReactDOM.render(</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;Index /&gt;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  document.getElementById('root')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">)</span></div></div><div><br/></div><div>这里用了一个新的数组 usesElements, 然后循环 users 数组, 为每个 user 构建一个 JSX 结构, 然后 push 到 usersElements 中. 然后直接用表达式插入, 把这个 usersElements 插到 return 的 JSX 当中. 因为 React.js 会自动帮我们把数组当中的 JSX 罗列渲染出来, 所以可以看到页面上显示:</div><div><img src="1.11 -- 渲染列表数据..._files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>但我们一般不会手动写循环来构建列表的 JSX 结构, 可以直接用 ES6 自带的 map (不了解 map 函数的同学可以先了解相关的只是再来回顾这里), 代码可以简化成:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>class Index extends Component {</div><div><span>    render() {</span></div><div><span>    </span><span>    return (</span></div><div><span>    </span><span>    <span>    &lt;div&gt;</span></span></div><div><span>    </span><span>    </span><span>    </span><span>    {users.map((user) =&gt; {</span></div><div><span>    </span><span>    </span><span>    </span><span>    </span><span>    return (</span></div><div><span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    &lt;div&gt;</span><br/></span></div><div><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    <span>     </span></span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&lt;</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(228, 86, 73); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">div</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&gt;</span><span style="color: rgb(56, 58, 66); font-family: Inconsolata; font-size: 14.4px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">姓名：{user.username}</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&lt;/</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(228, 86, 73); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">div</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&gt;</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> </span></div><div><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>  </span> &lt;</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(228, 86, 73); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">div</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&gt;</span><span style="color: rgb(56, 58, 66); font-family: Inconsolata; font-size: 14.4px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">年龄：{user.age}</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&lt;/</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(228, 86, 73); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">div</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&gt;</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"> </span></div><div><span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>&lt;</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(228, 86, 73); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">div</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&gt;</span><span style="color: rgb(56, 58, 66); font-family: Inconsolata; font-size: 14.4px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">性别：{user.gender}</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&lt;/</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(228, 86, 73); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">div</span><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);">&gt;</span><br/></span></div><div><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);"><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span><span>    &lt;hr /&gt;</span><br/></span></div><div><span style="border: 0px; font-variant-ligatures: normal; font-variant-caps: normal; font-size: 14.4px; font-family: Inconsolata; color: rgb(56, 58, 66); letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 250);"><span><span>    </span><span>    </span><span>    </span><span>    </span><span>    &lt;/div&gt;</span><br/></span></span></div><div><span><span><span>    </span><span>    </span><span>    </span><span>    </span><span>    </span>)</span><br/></span></div><div><span><span><span>    </span><span>    </span><span>    </span><span>    </span>})}</span><br/></span></div><div><span><span>    </span><span>    </span><span>    &lt;/div&gt;</span><br/></span></div><div><span><span><span>    </span><span>    </span>)</span><br/></span></div><div><span><span>    </span>}</span><br/></div><div>}</div></div><div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div>
这样的模式在 JavaScript 中非常常见, 一般来说, 在 React.js 处理列表就是用 map 来处理, 渲染的. 现在进一步把渲染单独一个用户的结构抽离出来作为一个组件, 继续优化代码:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">const users = [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Jerry', age: 21, gender: 'male' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Tomy', age: 22, gender: 'male' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Lily', age: 19, gender: 'female' },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  { username: 'Lucy', age: 20, gender: 'female' }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">]</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class User extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const { user } = this.props</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div&gt;姓名：{user.username}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div&gt;年龄：{user.age}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div&gt;性别：{user.gender}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;hr /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Index extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        {users.map((user) =&gt; &lt;User user={user} /&gt;)}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">ReactDOM.render(</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;Index /&gt;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  document.getElementById('root')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">)</span></div></div><div> <br/></div><div>这里把负责展示用户数据的 JSX 结构抽离成一个组件 User, 并且通过 props 把 user 数据作为组件的配置参数传进去; 这样改写 Index 就非常清晰了, 看一眼就知道负责渲染 users 列表, 而用的组件是 user.</div><div><br/></div><div><b>key! key! key!</b></div><div><br/></div><div>现在代码运行正常, 好像没什么问题, 但是打开控制台, 你会看到报错</div><div><br/></div><div>React.js 报错了, 如果要详细解释, 很困难, 但可以简单解释一下.</div><div><br/></div><div>React.js 是非常高效的, 它高效依赖于所谓的 Virtua-DOM 策略. 简单来说, 能复用的话 React.js 就会尽量复用, 没有必要的话绝对不碰 DOM. 对于列表元素来说也是这样的, 但是处理列表元素的复用性会有一个问题: 元素可能会在一个列表中改变位置. 例如:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div&gt;a&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div&gt;b&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div&gt;c&lt;/div&gt;</span></div></div><div><br/></div><div>假设页面上有这么3个元素, 现在改变一下位置:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div&gt;a&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div&gt;c&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div&gt;b&lt;/div&gt;</span></div></div><div><br/></div><div>位置互换了, 但其实 React.js 只需要互换一下 DOM 位置就行了, 但是它并不知道其实我们只改变了元素的位置, 所以它会重新渲染后面两个元素 (再执行 Virtual-DOM 策略), 这样会大大增加 DOM 操作. 但如果给每个元素加上唯一标识符, React.js 就可以知道这两个元素只是交换了位置:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div key='a'&gt;a&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div key='b'&gt;b&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;div key='c'&gt;c&lt;/div&gt;</span></div></div><div><br/></div><div>这样 React.js 就简单的通过 key 来判断出来, 这两个元素只是交换了位置, 可以尽量复用元素内部的结构.</div><div><br/></div><div>现在只要记住一个简单的规则: 对于用表达式套数组罗列到页面上的元素, 都要为每个元素加上 key 属性, 这个 key 必须是每个元素的唯一标识. 一般来说, key 的值可以直接跟后台数据返回的 id, 因为后台的 id 都是唯一的.</div><div><br/></div><div>在上面的例子当中, 每个 user 没有 id 可以用, 可以直接用循环计数器 i 作为 key:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Index extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        {users.map((user, i) =&gt; &lt;User key={i} user={user} /&gt;)}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>再看看, 控制台已经没有错误信息了. 但是这不好的做法, 只是掩耳盗铃 (具体原因自行思考). 记住这一点: 在实际的项目中, 如果你的数据顺序是可以变化的, 标准做法是最好是后台数据返回的 id 作为列表元素的 key.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 