# Vue 搭建多页+单页混合应用框架

使用 vue 搭建我们小语言的应用框架，单页面 + 多页面混合使用。

## 项目结构

```
│
├─build                             /* webpack的配置目录 */
│     ├─config.js                   /* 公共常量，用于配置文件 */
│     ├─utils.js                    /* 工具函数，用于配置文件 */
│     ├─webpack.base.conf.js        /* 公共配置文件 */
│     ├─webpack.dev.conf.js         /* 开发环境配置文件 */
│     └─webpack.prod.conf.js        /* 生产环境配置文件 */
│
├──mock                             /* mock服务和mock数据 */
│    ├─api                          /* 存放mock数据 */
│    └─mock-server.js               /* mock服务 */
│
├──src                              /* 项目源码 */
│    │
│    ├─api                          /* 所有后端接口 */
│    │  ├──index.js
│    │  └──product.js
│    │
│    ├─assets                       /* 公共的静态文件 */
│    │  ├─fonts
│    │  ├─img
│    │  └─style
│    │
│    ├─utils                        /* 业务无关的工具函数 */
│    │
│    ├─common                       /* 业务相关的公共函数 */
│    │      config.js
│    │      http.js
│    │
│    ├─components                   /* 公共组件, 如Dialog、Loading等 */
│    │  └─navbar
│    │
│    ├─pages                        /*  页面
│    │  │
│    │  ├─index/                        每个页面一个文件夹，当前页面的样式、图片、子组件都存放在自已的文件夹下。
│    │  │                               为了项目结构清晰，一级目录以模块划分，二级目录则为页面目录。
│    │  ├─my/                       */
│    │  │  └─order/
│    │  │
│    │  ├─product/
│    │  │   └─list/
│    │  │
│    │  ├─App.vue                   /* 多页应用的公共入口页面 */
│    │  │
│    │  └─main.js                   /* 多页应用的公共入口函数 */
│    │
│    ├─router                       /* 路由配置 */
│    │      router.js
│    │
│    └─store                        /* 状态管理 */
│       │  actions.js
│       │  getters.js
│       │  index.js
│       │  mutation-types.js
│       │  mutations.js
│       │
│       └─modules
│
├─── .babelrc                       /* babel配置 */
├─── .editorconfig                  /* 开发工具配置 */
├─── index.html                     /* 公共模板文件 */
├─── package.json                   /* 包描述文件 */
└─── postcss.config.js              /* postcss相关插件配置 */
```

## 项目简介

集 **多页应用 + 单页应用** 的混合项目框架。

适用于：

- 主页面入口生成多页
- 子页面使用单页形式

有这样需求的项目。

## 技术栈

- ES6
- Vue
- Vuex
- Vue-Router
- Axios
- Webpack

## 项目打包说明

- npm 模块（vue、vuex 之类）打包成单独的 JS 文件
- 公共组件和公共函数打包成单独的 JS 文件
- 单页和多页，都按照页面打包，每个页面打包成 JS 文件，按需加载
- 公共样式和各页面样式均各自打包成单独的 CSS 文件

## 多页配置

**多页面** 根据一个简单的入口文件（`entry.js`）便可以自动生成 HTML 页面。打包的时候，自动遍历 `/src/pages/` 目录，查找所有目录下的 `entry.js` 文件，每个入口文件都作为单独的打包入口，每个入口生成单独的 `.html` 文件

## 入口配置

在需要生成单独 HTML 页面的目录下（也就是模块目录）下新建 `entry.js` 文件，并引入一个公共的入口 JS 文件（可认为是继承自 `/src/pages/main.js`），并且给公共入口函数传递一个当前 HTML 页面的默认展示页面组件。

## 入口示例

`entry.js` 入口文件，只需要修改要加载的页面组件即可，比如此例中的 `.list.vue`

```js
// 导入公共入口文件（必须）
import main from '@pages/main'

// 默认加载的页面组件（必须）
import List from './list.vue'

// 传递一个要展示的页面组件给公共入口函数（必须）
main.init(List)
```

## HTML 模板

一个打包入口需要对应一个 HTML 模板。所有页面默认使用项目根目录下的 `/index.html` 作为模板。

如果某个单页面需要单独的 HTML 模板，可以在其目录下新建名为 `entry.html` 的文件，打包的时候自动将其识别为当前页面的模板。

> 只有在有入口文件（entry.js）存在的目录下添加单独的 HTML 模板，才会生效。

## 单页配置

根据 `vue-router` 插件的路由配置 `./router/router.js` 来生成单页 JS 文件。每个 HTML 页面都是共用的同一个路由配置（router.js），因此单页的页面组件可以渲染在任意一个 HTML 中。

## 插件说明

此示例中没有使用 `Generator函数` 和 `async/await`，所以排除了对应的babel插件，打包文件也小了 20 几 Kb，

如果你需要它们，可以在 `.babelrc` 文件中去掉排除项。

> 所用插件在package.json文件中可查看，具体插件功能及配置可到插件的npm包主页查看

## 安装插件

```
npm install
or
yarn install
```

## 开发 & 打包

执行以下命令预览非常简单的demo

```
//启动 Web 开发服务器与 Mock 服务器
npm start

//构建生产文件
npm run build
```





# mock数据服务

## 概述

1. 所有mock文件直接放在 `./api` 目录的根目录下。(不支持子目录,可自行修改mock-server.js来实现)
2. mock文件名必须和接口文件名一致，才能将请求接口匹配上mock文件。
3. mock文件可以是 `.js` 文件或 `.jso` 文件，如果对同一接口分别创建了js和json两个mock文件，会优先取js文件的数据。
4. json文件用来存放固定的mock数据，而js文件可更加自由的处理并返回mock数据。
5. 修改api目录下的mock文件后，无需重启node服务，重新调用接口会返回新的数据。

## 启动mock服务

有两种方式：

1、执行命令 **npm start** 启动当前项目时，会自动启动mock服务（此为默认方式，在package.json中配置）。

```
$ npm start
```

2、手动执行node服务文件 `./mock/mock-server.js`

```
$ node ./mock/mock-server.js
```

## 项目中使用mock接口

在配置文件 `/build/webpack.dev.conf` 中，使用webpack插件 `webpack-dev-server` 的代理属性 `(proxy)`，将接口服务器转发到mock服务器。

mock服务器接收到转发过来的请求后，截取URL请求路径中的接口名，再用API接口的名字去匹配 `./mock/api` 目录下的mock文件名，
最终返回mock文件中的数据。

## mock文件命名规则

mock文件名必须和接口文件名一致

> 例1：
>
> 如果接口为 "/service/user/getUserInfo"
>
> 则mock数据文件名为 "getUserInfo.js" 或者 "getUserInfo.json"
>
> 例2：
>
> 如果接口为 "/service/user/getUserInfo.do"
>
> 则mock数据文件名为 "getUserInfo.do.js" 或者 "getUserInfo.do.json"

## mock文件编写规则

`API接口名.json` 文件只支持json格式的数据，例:

```
{
  "code": 1,
  "msg": "失败",
  "data":{
      "age": 520,
      "card": 10099
  },
  "servertime": 1534835882204
}
```

`API接口名.js` 文件必须导出一个函数，函数接收两个参数，需在函数中返回mock数据，例：



```
/*
    返回mock数据

    @param {object} getData  接口的GET数据
    @param {object} postData 接口的POST数据
 */
module.exports = function(getData, postData) {
  //to do something...

  return {
    code: 0,
    msg: "成功"
    data: {}
  }
}
```





https://github.com/ahbool/vue-mix-pages/blob/master/mock/README.md