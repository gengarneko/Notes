# 计数排序（Counting Sort）

计数排序可以看作是桶排序的一种特殊情况，两者区别只在于粒度大小。

## 基本概念

当要排序的 n 个数据，所处范围并不大的时候（比如最大值 k，数据就分为 k 个桶）每个桶内数据值是相同的，省掉了桶内排序的时间。

比如考试成绩排名，0~480 分，我们就可以分为 481 个桶，然后根据考生成绩塞进不同的桶中，最后依次扫描桶，将所有考生成绩依次输出，就实现了所有考生的排序。因为只涉及遍历，所以时间复杂度为 `O(n)`。

计数排序算法思想如上所述，跟桶排序类似，只是桶的大小粒度不一样。那么，我们来想一下，**计数排序**的**计数**从何而来？

## 过程图解

我们依然用考试成绩的例子，0~5 分，8 个人，我们可以有一个数组：`a[2, 5, 3, 0, 2, 3, 0, 3]`，根据 0~5 分我们会得到一个 `c[6]` 的成绩数组，其中存储各个分数对应的考生个数，我们只需要遍历一遍考生分数，就可以得到 `c[6]` 的值。

![](https://i.loli.net/2019/03/14/5c89ab36f26e2.jpg)

如图，分数为 3 的有 3个，小于 3 的有 4 个，所以，成绩 3 的考生输出保存在新的数组 `R[8]` 的时候会保存在下标 4， 5， 6 的位置。那么，我们怎么算每个分数的考生在数组中对应的存储位置呢？

思路：对 `c[6]` 顺序求和，`c[6]` 就变成了这样子：（c[k] 存储小于等于分数 k 的考生个数）

![](https://i.loli.net/2019/03/14/5c89abf4a9a4e.jpg)

我们从后往前依次扫描数组 `a[8]`，当扫描到 3 的时候，我们从数组 `c[6]` 中取出下标为 3 的值：7，也就是说，包括自身，分数小于等于 3 的考生有 7 个，也就是说 3 是数组 `R[8]` 的第 7 个元素（也就是下标 6）。当 3 放入到数组 `R[8]` 之后，小于等于 3 的元素只剩下 6 个了，`c[3] - 1` 变为 6。

这样循环下去，当我们遍历到第二个 3 分学生时，将它放入数组 R 第 6 个（下标 5）的位置，数组 c[3] 减一。

![](https://i.loli.net/2019/03/14/5c89ad8f5e70b.jpg)

## 流程图与伪代码

> 我还是习惯先写伪代码：

```
// 要排序的数组
a <- {'0':2,'1':5,'2':3,'3':0,'4':2,'5':3,'6':0,'7':3,'length':8}

// 寻找最大值，确认计数范围
max <- findMax(a);

// 申请计数数组
c <- {}

// 遍历数组，元素个数放入 c
for(i <- 0; i < a['length']; ++i)
	c[a[i]] <- c[a[i]] + 1
	
// 对数组 c 进行累加处理
for(i <- 1; i <= max; ++i)
	c[i] <- c[i-1] + c[i]
	
// 申请存储数组
r <- {}

// 数组顺序输入存储数组
for (i <- a['length']-1; i >= 0; --i) {
	index <- c[a[i]] - 1
	r[index] <- a[i]
	c[a[i]] <- c[a[i]] - 1
}
```

相应的流程图：

![](https://i.loli.net/2019/03/14/5c89c88f04721.png)

## 代码实现

```js
function countingSort(iArr, max) {
    var n = iArr.length;
    var oArr = [];
    // 创建长度max的数组，填充0
    var C = [];
    for(var i = 0; i <= max; i++){
        C[i] = 0;
    }
    // 遍历输入数组，填充C
    for(var j = 0; j < n; j++){
        C[iArr[j]]++;
    }
    // 遍历C，输出数组
    for(var k = 0; k <= max; k++){
        // 按顺序将值推入输出数组，并将对应标志位减1
        while(C[k]-- > 0){
            oArr.push(k);
        }
    }
    return oArr;
}
```



## 计数排序小结

**计数排序只能用在数据范围不大的场景中，如果数据范围 k 比要排序的数据 n 大很多，就不适合用计数排序了。而且，计数排序的数组实现只能给非负整数排序，如果要排序的数据是其他类型，我们需要使用 hash 之类的键值对数据结构。**

比如，上面的例子中分数有小数点，我们就需要将所有分数进行乘 10 的预处理，然后再排进桶中。