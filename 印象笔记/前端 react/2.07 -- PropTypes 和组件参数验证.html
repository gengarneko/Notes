<html>
<head>
  <title>2.07 -- PropTypes 和组件参数验证</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1329"/>
<h1>2.07 -- PropTypes 和组件参数验证</h1>

<div>
<span><div>本章节对构建多人协作, 大型的应用程序的时候也是非常重要.</div><div><br/></div><div>JavaScript 的灵活性体现在弱类型, 高阶函数等语言特性上. 而语言的弱类型一般也让我们写代码很爽, 但是也容易出 BUG.</div><div><br/></div><div>变量没有固定类型可以随意赋值, 在我们构建大型应用程序的时候并不是什么好的事情. 某个地方写下 let a = {}, 如果是共享的状态别人写成 a = 3, 那么 a.xxx 就会让程序崩溃. 而这种错误在 C/ Java 中是不可能出现的, 编译都不能通过.</div><div><br/></div><div>大型应用程序的构建其实更适合用强类型的语言来构建, 它有更多的规则, 可以帮助我们在编写代码阶段, 编译阶段就规避掉很多问题, 让我们的应用程序更加的安全. JavaScript 早就脱离了玩具语言的领域并投入到大型应用程序的生产活动中, 因为它的弱类型, 常常意味着不安全. 所以近年来出现了类似于 TypeScript 和 Flow 等技术, 来弥补 JavaScript 这方面的缺陷.</div><div><br/></div><div>React.js 的组件其实是为了构建大型应用程序而生的. 但是因为 JavaScript 这样的特性, 你在写了一个组件之后, 根本不知道别人会传什么参数进来, 例如:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Comment extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const { comment } = this.props</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div className='comment'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div className='comment-user'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;{comment.username} &lt;/span&gt;：</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;p&gt;{comment.content}&lt;/p&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>但是别人往里面传一个数字你一点办法都没有</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;Comment comment={1} /&gt;</span></div></div><div><br/></div><div>JavaScript 在这种情况下是不会报任何错误的, 但是页面就是现实不正常, 然后我们踏上了漫长的 debug 之旅.</div><div><br/></div><div>于是 React.js 就提供了一种机制, 让你可以给组件的配置参数加上类型验证, 就用上述的评论组件例子, 你可以配置 Comment 只能接受对象类型的 comment 参数, 你传个数字进来组件就强制报错. 我们这里先安装一个 React 提供的第三方库 prop-types:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">npm install --save prop-types</span></div></div><div><br/></div><div>它可以帮助我们验证 props 的参数类型, 例如:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component } from 'react'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import PropTypes from 'prop-types'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Comment extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  static propTypes = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    comment: PropTypes.object</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const { comment } = this.props</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div className='comment'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div className='comment-user'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;{comment.username} &lt;/span&gt;：</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;p&gt;{comment.content}&lt;/p&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>注意, 我们在文件头部引入了 PropTypes, 并且给 Comment 组件类添加了类属性 propTypes, 里面的内容的意思是你传入的 comment 类型必须为 object (对象).</div><div><br/></div><div>这时候再向里面传入数字, 就会报错</div><div><br/></div><div>出错信息明确告诉你, 你给 Comment 组件传入一个数字类型的 comment, 而它应该是 object. 你就清晰知道问题出在哪里了.</div><div><br/></div><div>虽然 propTypes 帮我们指定了参数类型, 但是并没有说这个参数一定要传入, 事实上, 这些参数默认都是可选的. 可选参数我们可以通过配置 defaultProps, 让它们在不传入的时候有默认值. 但是我们这里并没有配置 defaultProps, 所以如果直接用 &lt;Comment /&gt; 而不传入任何参数的话, comment 就会是 undefined, comment.username 会导致程序报错.</div><div><br/></div><div>这个报错信息并不够友好, 我们可以通过 isRequired 关键字来强制组件某个参数必须传入:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">static propTypes = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  comment: PropTypes.object.isRequired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>那么会获得一个更加友好的出错信息, 差错会更加方便</div><div><br/></div><div>React.js 提供的 PropTypes 提供了一系列的数据类型可以用来配置组件的参数</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.array</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.bool</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.func</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.number</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.object</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.string</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.node</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">PropTypes.element</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>更多类型及其用法可以参考官方文档</div><div><br/></div><div>组件参数验证在构建大型的组件库的时候相当有用, 可以帮助我们迅速定位这种类型错误, 让我们组件开发更加规范, 另外也起到了一个说明文档的作用, 如果大家都约定都写 propTypes, 那你在使用别人写的组件的时候, 只要看到组件的 propTypes 就清晰的知道这个组件到底能够接受什么参数, 什么参数是可选的, 什么参数是必选的.</div><div><b><br/></b></div><div><b>总结</b></div><div><b><br/></b></div><div>通过 PropTypes 给组件的参数做类型限制, 可以在帮助我们迅速定位错误, 这在构建大型应用程序的时候非常有用; 另外, 给组件加上 propTypes, 也让组件的开发, 使用更加规范清晰.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 