<html>
<head>
  <title>1.07 -- 事件监听</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1366"/>
<h1>1.07 -- 事件监听</h1>

<div>
<span><div>在 React.js 里面监听事件是很容易的事情, 你只需要给需要监听事件的元素加上属性类似于 onClick, onKeyDown 这样的属性, 例如我们现在要给 Title 加上点击的事件监听:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Title extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleClickOnTitle () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log('Click on title.')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;h1 onClick={this.handleClickOnTitle}&gt;React 小书&lt;/h1&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>只需要给 h1 标签加上 onClick 的事件, onClick 紧跟着是一个表达式插入, 这个表达式返回一个 Title 自己的一个实例方法. 当用户点击 h1 的时候, React.js 就会调用这个方法, 所以你在控制台就可以看到 Click on title 打印出来.</div><div><br/></div><div>在 React.js 不需要手动调用浏览器原生的 addEventListener 进行事件监听. React.js 帮我们封装了一系列的 on* 的属性, 当你需要为某个元素监听某个事件的时候, 只需要简单地给它加上 on* 就可以了. 而且你不需要考虑不同浏览器兼容问题, React.js 都帮我们封装好这些细节.</div><div><br/></div><div>React.js 封装了不同类型的事件, 这里就不列举了, 参考官方文档: SyntheticEvent - React, 这些事件属性名必须要用驼峰命名.</div><div><br/></div><div>没经过特殊处理的话, 这些 on* 的事件监听只能在普通的 HTML 的标签上, 而不能用在组件标签上. 也就是说, &lt;Header onClick={..} /&gt; 这样的写法不会有什么效果. 这一点是要注意的, 但是有办法可以做到这样的绑定, 以后我们会提及. 现在我们只需要考虑 on* 事件监听只能用在普通的 HTML 标签上面.</div><div><br/></div><div>event 对象</div><div><br/></div><div>和普通浏览器一样, 事件监听函数会被自动传入一个 event 对象, 这个对象和普通的浏览器的 event 对象所包含的方法和属性都基本一致. 不同的是 React.js 中的 event 对象并不是浏览器提供的, 而是它自己内部所构建的. React.js 将浏览器原生的 event 对象封装了一下, 对外提供统一的 API和属性, 这样你就可以不用考虑不同浏览器之间的兼容问题. 这个 event 对象是符合 W3C 标准的, 它具有了类似于 event.stopPropagation, event.preventDefault 这样常用的方法.</div><div><br/></div><div>我们来尝试一下, 这次尝试当用户点击 h1 的时候, 把 h1 的 innerHTML 打印出来:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Title extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleClickOnTitle (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log(e.target.innerHTML)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;h1 onClick={this.handleClickOnTitle}&gt;React 小书&lt;/h1&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>再看控制台, 可以看到内容被打印出来.</div><div><br/></div><div>关于事件中的 this</div><div><br/></div><div>一般在某个类的实例方法里面的 this 指的是这个实例本身. 但是你在上面的 handleClickOnTitle 中把 this 打印出来, 你会看到 this 是 null 或 undefined.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleClickOnTitle (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log(this) // =&gt; null or undefined</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>这是因为 React.js 调用你所传给它的方法的时候, 并不是通过对象方法的方式调用 (this.handleClickOnTitle), 而是直接通过函数调用 (handleClickOnTitle), 所以事件监听函数并不能通过 this 获取到实例.</div><div><br/></div><div>如果你想在事件函数当中使用当前的实例, 你需要手动地将实例方法 bind 到当前实例上再传入给 React.js.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Title extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleClickOnTitle (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log(this)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;h1 onClick={this.handleClickOnTitle.bind(this)}&gt;React 小书&lt;/h1&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>bind 会把实例方法绑定到当前实例上, 然后我们再把绑定后的函数传给 React.js 的 onClick 事件监听. 这时候你再看看, 点击 h1 的时候, 就会把当前实例打印出来:</div><div><br/></div><div><img src="1.07 -- 事件监听_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>你也可以在 bind 的时候给事件监听函数传入一些参数:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Title extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleClickOnTitle (word, e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log(this, word)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;h1 onClick={this.handleClickOnTitle.bind(this, 'Hello')}&gt;React 小书&lt;/h1&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>这种 bind 模式在 React.js 的事件监听当中非常常见, bind 不仅可以帮我们把事件监听方法中的 this 绑定到当前组件实例上; 还可以帮助我们在渲染列表元素的时候, 把列表元素传入事件监听函数当中.</div><div><br/></div><div>如果对 JavaScript 的 this 模式或者 bind 函数的使用方式不太了解, 去看 JavaScript 相关教程.</div><div><br/></div><div>总结</div><div><br/></div><div>为 React 的组件添加事件是很简单的事情, 只需要使用 React.sj 提供了一系列的 on* 方法即可.</div><div><br/></div><div>React.js 会给每个事件监听传入一个 event 对象, 这个对象提供的功能和浏览器提供的功能一致, 而且它是兼容所有浏览器的.</div><div><br/></div><div>React.js 的事件监听方法需要手动 bind 到当前实例, 这种模式在 React.js 中非常常用.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 