<html>
<head>
  <title>10.2--粉丝数据表</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1462"/>
<h1>10.2--粉丝数据表</h1>

<div>
<span><div>粉丝数据表</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$ git checkout master</div><div>$ git checkout -b following-users</div></div><div><br/></div><div>粉丝表的构建</div><div><br/></div><div>在 A 关注了 B 之后, A 将成为 B的粉丝, B 成为 A 的关注用户, 在 A 取消关注之后, B 将从 A 的关注人列表中被移除, A 将从 B的粉丝列表中被移除, 可见, 在关注用户功能的整个了流程当中, 最重要的两个主体分别是被关注的用户 (user_id) 和粉丝 (follower_id) , 我们可以通过被关注的用户 (user_id) 来获取所有的粉丝, 也能通过一个粉丝 (follower_id) 来获取他关注的所有用户, 现在, 我们通过创建一个粉丝表来存放用户对应关注的所有粉丝</div><div><br/></div><div>我们需要为粉丝关系表生成一个迁移文件</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$ php artisan make:migration create_followers_table --create=&quot;followers&quot;</div></div><div><br/></div><div>并在迁移文件中增加了两个字段, user_id 和 follower_id 用于以下操作</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">database/migrations/[timestamp]_create_followers_table.php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Support\Facades\Schema;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Database\Schema\Blueprint;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Database\Migrations\Migration;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class CreateFollowersTable extends Migration</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * Run the migrations.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     *</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * @return void</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function up()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Schema::create('followers', function (Blueprint $table) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;increments('id');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;integer('user_id')-&gt;index();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;integer('follower_id')-&gt;index();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;timestamps();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        });</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * Reverse the migrations.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     *</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * @return void</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function down()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Schema::dropIfExists('followers');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>接着进行数据库迁移</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$ php artisan migrate</div></div><div><br/></div><div><br/></div><div>关注的人和粉丝</div><div><br/></div><div>在用户关注功能中, 一个用户 (粉丝) 可以关注多人, 被关注者可以拥有多个粉丝, 这是多对多关系, 在 laravel 中我们使用 belongToMany 来关联模型之间的多对多关系,</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public function followers()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return $this-&gt;belongsToMany(User::Class);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>在laravel 中我们会默认将两个关联模型名称进行合并, 并按照字母排序, 因此我们生成的关联关系表名称会是 user_user, 我们也可以自定义名称, 改为 followers.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public function followers()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return $this-&gt;belongsToMany(User::Class, 'followers');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>除了自定义合并数据表的名称, 我们也可以通过传递额外参数至 belongsToMany 方法来自定义数据表里的字段名称, </div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">public function followers()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return $this-&gt;belongsToMany(User::Class, 'followers', 'user_id', 'follower_id');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>第三个参数 user_id 是定义在关联中的模型外键名, 第四个参数 follower_id 是要合并的模型外键名.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">app/Models/User.php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">namespace App\Models;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class User extends Authenticatable</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function followers()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return $this-&gt;belongsToMany(User::Class, 'followers', 'user_id', 'follower_id');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function followings()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return $this-&gt;belongsToMany(User::Class, 'followers', 'follower_id', 'user_id');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}    </span></div></div><div><br/></div><div><br/></div><div>我们可以通过 followers 来获取粉丝关系列表</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$user-&gt;folllower();</div></div><div><br/></div><div>通过 followings 来获取用户关注人列表</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$user-&gt;followings();</div></div><div><br/></div><div>在我们对用户和粉丝模型进行了多对多关联之后, 扁你可以使用 Eloquent 模型为多对多提供的一系列简便的方法, 使 attach 方法或者 sync 方法在中间表上创建一个多对多记录, 使用 detach 方法在中间表上移除一个记录, 创建和移除操作并不会影响两个模型各自的数据, 所有的数据变动都在中间表上进行, attach , sync detach 这几个方法都允许传入 id 数组参数</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$ php artisan tinker</div></div><div><br/></div><div>当 id 为 1 的用户去关注 id 为 2 和 3 的 用户时, 可使用 attach 方法来关注, 如下</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user = App\Models\User::find(1)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;attach([2, 3])</span></div></div><div><br/></div><div>对用户进行关注之后, 我们可以通过下面的方法来输出关联的 id 数组查看创建结果</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;allRelatedIds()-&gt;toArray()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">=&gt; [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     2,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     3,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   ]</span></div></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;"><br/></span></div><div><font color="#333333" face="Monaco"><span style="font-size: 12px;">allRelatedIds 是 Eloquent 关联关系提供的 API , 用来获取关联模型的 ID 集合, </span></font></div><div><font color="#333333" face="Monaco"><span style="font-size: 12px;"><br/></span></font></div><div><font color="#333333" face="Monaco"><span style="font-size: 12px;">可以看到 id 2 和 id 3 的用户已经成功添加到关联 id 数组当中, 但是 attach 方法有个问题, 在我们对同一 id 进行添加时, 则会出现 id 重复的情况, 例如, 接着对 id 2 的用户进行关注</span></font></div><div><font color="#333333" face="Monaco"><span style="font-size: 12px;"><br/></span></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;attach([2])</span></font></div><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;allRelatedIds()-&gt;toArray()</span></font></div><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">=&gt; [</span></font></div><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     2,</span></font></div><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     3,</span></font></div><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     2,</span></font></div><div><font color="#333333" face="Monaco"><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   ]</span></font></div></div><div><br/></div><div>可以看到 id 2 的重复数据</div><div><br/></div><div>为了解决这个问题, 我们使用 sync 方法, sync 方法接收两个参数, 第一个参数为要进行添加的 id , 第二个参数则指明是否要移除其他不包含在关联 id 数组中 id , true 表示移除, 默认为 true, </div><div>由于我们在关注一个新用户的时候, 仍要保持之前已关注用户的关注关系, 因此不能对进行移除, 所以我们这里选用 false , 现在让我们进行尝试.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;sync([3], false)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;allRelatedIds()-&gt;toArray()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">=&gt; [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     2,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     3,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     2,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   ]</span></div></div><div><br/></div><div>可以看到重复数据 id 3 不会被创建.</div><div><br/></div><div>最后我们借助 detach 对用户进行取消关注的操作</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;detach([2,3])</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt;&gt;&gt; $user-&gt;followings()-&gt;allRelatedIds()-&gt;toArray()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">=&gt; []</span></div></div><div><br/></div><div>借助这两个方法可以很方便地实现用户关注和取消关注这两个功能, 具体在用户模型中定义关注 (follow) 和 取消关注(unfollow) 的方法</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">app/Models/User.php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">namespace App\Models;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class User extends Authenticatable</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function follow($user_ids)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (!is_array($user_ids)) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $user_ids = compact('user_ids');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        $this-&gt;followings()-&gt;sync($user_ids, false);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function unfollow($user_ids)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (!is_array($user_ids)) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $user_ids = compact('user_ids');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        $this-&gt;followings()-&gt;detach($user_ids);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}    </span></div></div><div><br/></div><div>is_array 判断传入参数是否为数组, 如果为数组, 则使用 compact 方法, sync 方法接收一个数组, 如果不是在数组 compact 方法将其自动转换为关联数组. 我们没有给 sync 和 detach 方法指定传递参数为用户的 id ,这两个方法会自动获取数组中的 id.</div><div><br/></div><div>接下来我们还需要一个方法用于判断当前登录的用户 A 是否关注了用户 B , 代码实现逻辑很简单, 我们只需要判断 B 是否包含在 A 的关注人列表里面即可, 这里我们用到 contains 方法;来做判断.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">app/Models/User.php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">namespace App\Models;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class User extends Authenticatable</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    .</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function isFollowing($user_id)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return $this-&gt;followings-&gt;contains($user_id);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 