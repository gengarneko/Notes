<html>
<head>
  <title>01 -- ES6 简介</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1393"/>
<h1>01 -- ES6 简介</h1>

<div>
<span><div>1.ES 和 JS 的关系</div><div><br/></div><div>要讲清楚这个问题，需要回顾历史。1996 年 11 月，JavaScript 的创造者 Netscape 公司，决定将 JavaScript 提交给标准化组织 ECMA，希望这种语言能够成为国际标准。次年，ECMA 发布 262 号标准文件（ECMA-262）的第一版，规定了浏览器脚本语言的标准，并将这种语言称为 ECMAScript，这个版本就是 1.0 版。</div><div>该标准从一开始就是针对 JavaScript 语言制定的，但是之所以不叫 JavaScript，有两个原因。一是商标，Java 是 Sun 公司的商标，根据授权协议，只有 Netscape 公司可以合法地使用 JavaScript 这个名字，且 JavaScript 本身也已经被 Netscape 公司注册为商标。二是想体现这门语言的制定者是 ECMA，不是 Netscape，这样有利于保证这门语言的开放性和中立性。</div><div>因此，ECMAScript 和 JavaScript 的关系是，前者是后者的规格，后者是前者的一种实现（另外的 ECMAScript 方言还有 Jscript 和 ActionScript）。日常场合，这两个词是可以互换的。</div><div><br/></div><div>2.ES6 与 ES2015 的关系</div><div><br/></div><div>ES6 既是一个历史名词，也是一个泛指，含义是 5.1 版以后的 JavaScript 的下一代标准，涵盖了 ES2015、ES2016、ES2017 等等，而 ES2015 则是正式名称，特指该年发布的正式版本的语言标准。本书中提到 ES6 的地方，一般是指 ES2015 标准，但有时也是泛指“下一代 JavaScript 语言”。</div><div><br/></div><div>3.语法提案的批准流程</div><div><br/></div><div>任何人都可以向标准委员会（又称 TC39 委员会）提案，要求修改语言标准。</div><div>一种新的语法从提案到变成正式标准，需要经历五个阶段。每个阶段的变动都需要由 TC39 委员会批准。</div><div>* Stage 0 - Strawman（展示阶段）</div><div>* Stage 1 - Proposal（征求意见阶段）</div><div>* Stage 2 - Draft（草案阶段）</div><div>* Stage 3 - Candidate（候选人阶段）</div><div>* Stage 4 - Finished（定案阶段）</div><div>一个提案只要能进入 Stage 2，就差不多肯定会包括在以后的正式标准里面。ECMAScript 当前的所有提案，可以在 TC39 的官方网站Github.com/tc39/ecma262查看。</div><div><br/></div><div>4.ESMAScript 的历史</div><div><br/></div><div>5.部署进度</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install -g es-checker</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ es-checker</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">=========================================</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Passes 24 feature Dectations</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Your runtime supports 57% of ECMAScript 6</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">=========================================</span></div></div><div><br/></div><div>6.Babel 转码器</div><div><br/></div><div>Babel 是一个广泛使用的 ES6 转码器, 可以将 ES6 代码转为 ES5 代码, 从而在现有环境执行. 这意味着你可以用 ES6 方式编写程序, 又不用担心环境是否支持. </div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 转码前</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">input.map(item =&gt; item + 1);</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 转码后</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">input.map(function (item) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return item + 1;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">});</span></div></div><div><br/></div><div>上面的原始代码用了箭头函数, Babel 将其转为普通函数, 就能在不支持箭头函数的 JS 环境执行了.</div><div><br/></div><div><br/></div><div><b>配置文件 .babelrc </b></div><div><br/></div><div>Babel 的配置文件是 .babelrc, 存放在项目的根目录下. 使用 Babel 的第一步, 就是配置这个文件.</div><div><br/></div><div>该文件用来设置转码规则和插件, 基本格式如下</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;presets&quot;: [],</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;plugins&quot;: []</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>presets 字段设定转码规则, 官方提供以下的规则集, 你可以根据需要安装.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 最新转码规则</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-preset-latest</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># react 转码规则</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-preset-react</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 不同阶段语法提案的转码规则（共有4个阶段），选装一个</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-preset-stage-0</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-preset-stage-1</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-preset-stage-2</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-preset-stage-3</span></div></div><div><br/></div><div>然后, 将这些规则加入 .bladerc</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;presets&quot;: [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &quot;latest&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &quot;react&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &quot;stage-2&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    ],</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;plugins&quot;: []</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>注意, 以下所有 Babel 工具和模块的使用, 都必须先写好 .babelrc</div><div><br/></div><div><br/></div><div>命令行转码 babel-cli</div><div><br/></div><div>Babel 提供 babel-cli 工具, 用于命令转码</div><div><br/></div><div>它的安装命令如下</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --global babel-cli</span></div></div><div><br/></div><div>基本语法如下</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 转码结果输出到标准输出</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel example.js</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 转码结果写入一个文件</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># --out-file 或 -o 参数指定输出文件</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel example.js --out-file compiled.js</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 或者</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel example.js -o compiled.js</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 整个目录转码</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># --out-dir 或 -d 参数指定输出目录</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel src --out-dir lib</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 或者</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel src -d lib</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># -s 参数生成source map文件</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel src -d lib -s</span></div></div><div><br/></div><div>上面代码是在全局环境下, 进行 Babel 转码, 这意味着, 如果项目要运行, 全局环境必须有 Babel, 也就是说项目产生了对环境的依赖. 另一方面, 这样做也无法支持不同项目使用不同版本的 Babel.</div><div><br/></div><div>一个解决方法是将 babel-cli 安装在项目中</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"># 安装</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-cli</span></div></div><div><br/></div><div>然后, 改写 package.json</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  // ...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;devDependencies&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;babel-cli&quot;: &quot;^6.0.0&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;scripts&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;build&quot;: &quot;babel src -d lib&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>转码的时候, 就执行下面的命令</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm run build</span></div></div><div><br/></div><div><br/></div><div><br/></div><div>babel-node</div><div><br/></div><div>babel-cli 工具自带一个 babel-node 命令, 提供一个支持 ES6 的 REPL 环境, 它支持 Node 的 REPL 环境的所有功能, 而且可以直接运行 ES6 代码.</div><div><br/></div><div>它不用单独安装, 而是随 babel-cli 一起安装, 然后, 执行 babel-node 就进入 REPL 环境</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel-node</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&gt; (x =&gt; x * 2)(1)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">2</span></div></div><div><br/></div><div>babel-node 命令可以直接运行 ES6 脚本, 将上面的代码放入脚本 es6.js, 然后直接运行.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ babel-node es6.js</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">2</span></div></div><div><br/></div><div>babel-node 也可以安装在项目中.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-cli</span></div></div><div><br/></div><div>然后, 改写 package.json</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;scripts&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;script-name&quot;: &quot;babel-node script.js&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>上面代码中, 使用 babel-node 替代 node, 这样 script.js 本身就不用做任何转码处理.</div><div><br/></div><div><br/></div><div>babel-register</div><div><br/></div><div>babel-register 模块改写 require 命令, 为它加上一个钩子. 此后, 每当使用 require 加载 .js, .jsx, .es 和 .es6 后缀的文件, 就会先用 Babel 进行转码.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babel-register</span></div></div><div><br/></div><div>使用时, 必须首先加载 babel-register</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">require(&quot;babel-register&quot;);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">require(&quot;./index.js&quot;);</span></div></div><div><br/></div><div>然后, 就不需要手动对 index.js 转码了.</div><div>需要注意的是, babel-register 只会对 require 命令加载的文件转码, 而不会对当前文件转码. 另外, 由于它是实时转码, 所以只适合在开发环境使用.</div><div><br/></div><div><br/></div><div>babel-core</div><div><br/></div><div>如果某些代码需要调用 Babel 的 API 进行转码, 就要使用 babel-core 模块.</div><div><br/></div><div>安装命令如下</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install babel-core --save</span></div></div><div><br/></div><div>然后, 就可以在项目中调用 babel-core</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var babel = require('babel-core');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 字符串转码</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">babel.transform('code();', options);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// =&gt; { code, map, ast }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 文件转码（异步）</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">babel.transformFile('filename.js', options, function(err, result) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  result; // =&gt; { code, map, ast }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">});</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 文件转码（同步）</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">babel.transformFileSync('filename.js', options);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// =&gt; { code, map, ast }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"><br/></span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// Babel AST转码</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">babel.transformFromAst(ast, code, options);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// =&gt; { code, map, ast }</span></div></div><div><br/></div><div>配置对象options，可以参看官方文档 <a href="http://babeljs.io/docs/usage/options/">http://babeljs.io/docs/usage/options/</a></div><div><br/></div><div>下面是一个例子</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var es6Code = 'let x = n =&gt; n + 1';var es5Code = require('babel-core')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  .transform(es6Code, {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    presets: ['latest']</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  .code;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// '&quot;use strict&quot;;\n\nvar x = function x(n) {\n  return n + 1;\n};'</span></div></div><div><br/></div><div>上面代码中, transform 方法的第一个参数是一个字符串, 表示需要被转码的 ES6 代码, 第二个参数是转换的配置对象.</div><div><br/></div><div><br/></div><div>babel-polyfill</div><div><br/></div><div>Babel 默认只转换新的 JS 句法 (syntax), 而不转换新的 API, 比如 Iterator, Generator, Set, Map, Proxy, Reflect, Symbol, Promise 等全局对象, 以及一些定义在全局对象上的方法 (比如 Object.assign) 都不会转码.</div><div><br/></div><div>举例来说, ES6 在 Array 对象上新增了 Array.from 方法. Babel 就不会转码这个方法. 如果想让这个方法运行, 必须使用 babel-polyfill, 为当前环境提供一个垫片.</div><div><br/></div><div>安装命令如下.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save babel-polyfill</span></div></div><div><br/></div><div>然后, 在脚本头部, 放入如下一行代码.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import 'babel-polyfill';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 或者</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">require('babel-polyfill');</span></div></div><div><br/></div><div>Babel 默认不转码的 API 非常多, 详细清单可以查看babel-plugin-transform-runtime模块的definitions.js文件。</div><div><br/></div><div><br/></div><div>浏览器环境</div><div><br/></div><div>Babel 也可以用于浏览器环境. 但是, 从 Babel 6.0 开始, 不再直接提供浏览器版本, 而是要用构建工具构建出来. 如果你没有或不想用构建工具, 可以使用 babel-standalone 模块提供的浏览器版本, 将其插入网页.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.4.4/babel.min.js&quot;&gt;&lt;/script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script type=&quot;text/babel&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// Your ES6 code</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/script&gt;</span></div></div><div><br/></div><div>注意, 网页实时将 ES6 代码转为 ES5, 对性能会产生影响. 生产环境需要加载已经转码完成的脚本.</div><div><br/></div><div>下面是如何将代码打包成浏览器可以使用的脚本, 以 Babel 配合 Browserify 为例. 首先, 安装 babelify 模块.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev babelify babel-preset-latest</span></div></div><div><br/></div><div>然后, 再用命令转换 ES6 脚本.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$  browserify script.js -o bundle.js \</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  -t [ babelify --presets [ latest ] ]</span></div></div><div><br/></div><div>上面代码将 ES6 脚本 script.js, 转为 bundle.js, 浏览器直接加载后者就可以了.</div><div>在 package.json 设置下面的代码, 就不用每次命令都输入参数了.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;browserify&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;transform&quot;: [[&quot;babelify&quot;, { &quot;presets&quot;: [&quot;latest&quot;] }]]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><br/></div><div>在线转换</div><div><br/></div><div>Babel 提供了一个 REPL 在线编译器, 可以在线将 ES6 代码转换为 ES5 代码. 转换后的代码, 可以直接作为 ES5 代码插入网页运行.</div><div><br/></div><div><br/></div><div>与其他工具的配合</div><div><br/></div><div>许多工具需要 Babel 进行前置转码, ESLint 和 Mocha</div><div><br/></div><div>ESLint 用于静态检查代码的语法和风格, 安装命令如下.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install --save-dev eslint babel-eslint</span></div></div><div><br/></div><div>然后, 在项目根目录下面, 新建一个配置文件 .eslintrc, 在其中加入 parser 字段</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;parser&quot;: &quot;babel-eslint&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;rules&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    ...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>再在 package.json 之中, 加入相应的 scripts 脚本</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;name&quot;: &quot;my-module&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;scripts&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &quot;lint&quot;: &quot;eslint my-files.js&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    },</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;devDependencies&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &quot;babel-eslint&quot;: &quot;...&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &quot;eslint&quot;: &quot;...&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>Mocha 则是一个测试框架, 如果需要执行使用 Es6 语法的测试脚本, 可以修改 package.json 的 scripts.test </div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&quot;scripts&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;test&quot;: &quot;mocha --ui qunit --compilers js:babel-core/register&quot;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>上面命令中，--compilers参数指定脚本的转码器，规定后缀名为js的文件，都需要使用babel-core/register先转码。</div><div><br/></div><div><br/></div><div>7.Traceur 转码器</div><div><br/></div><div>Google 公司的Traceur转码器，也可以将 ES6 代码转为 ES5 代码。</div><div><br/></div><div><br/></div><div>直接插入网页</div><div><br/></div><div>Traceur 允许将 ES6 代码直接插入网页。首先，必须在网页头部加载 Traceur 库文件。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script src=&quot;https://google.github.io/traceur-compiler/bin/traceur.js&quot;&gt;&lt;/script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script src=&quot;https://google.github.io/traceur-compiler/bin/BrowserSystem.js&quot;&gt;&lt;/script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script src=&quot;https://google.github.io/traceur-compiler/src/bootstrap.js&quot;&gt;&lt;/script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script type=&quot;module&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  import './Greeter.js';</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/script&gt;</span></div></div><div><br/></div><div>上面代码中，一共有 4 个script标签。第一个是加载 Traceur 的库文件，第二个和第三个是将这个库文件用于浏览器环境，第四个则是加载用户脚本，这个脚本里面可以使用 ES6 代码。</div><div><br/></div><div>注意，第四个script标签的type属性的值是module，而不是text/javascript。这是 Traceur 编译器识别 ES6 代码的标志，编译器会自动将所有type=module的代码编译为 ES5，然后再交给浏览器执行。</div><div><br/></div><div>除了引用外部 ES6 脚本，也可以直接在网页中放置 ES6 代码。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script type=&quot;module&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class Calc {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      console.log('Calc constructor');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    add(a, b) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return a + b;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  var c = new Calc();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  console.log(c.add(4,5));</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/script&gt;</span></div></div><div><br/></div><div>正常情况下，上面代码会在控制台打印出9。</div><div><br/></div><div>如果想对 Traceur 的行为有精确控制，可以采用下面参数配置的写法。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  // Create the System object</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  window.System = new traceur.runtime.BrowserTraceurLoader();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  // Set some experimental options</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  var metadata = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    traceurOptions: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      experimental: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      properTailCalls: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      symbols: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      arrayComprehension: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      asyncFunctions: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      asyncGenerators: exponentiation,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      forOn: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      generatorComprehension: true</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  };</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  // Load your module</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  System.import('./myModule.js', {metadata: metadata}).catch(function(ex) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.error('Import failed', ex.stack || ex);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  });</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/script&gt;</span></div></div><div><br/></div><div>上面代码中，首先生成 Traceur 的全局对象window.System，然后System.import方法可以用来加载 ES6。加载的时候，需要传入一个配置对象metadata，该对象的traceurOptions属性可以配置支持 ES6 功能。如果设为experimental: true，就表示除了 ES6 以外，还支持一些实验性的新功能。</div><div><br/></div><div><br/></div><div>在线转换</div><div><br/></div><div>Traceur 也提供一个在线编译器，可以在线将 ES6 代码转为 ES5 代码。转换后的代码，可以直接作为 ES5 代码插入网页运行。</div><div><br/></div><div>上面的例子转为 ES5 代码运行，就是下面这个样子。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;script src=&quot;https://google.github.io/traceur-compiler/bin/traceur.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://google.github.io/traceur-compiler/bin/BrowserSystem.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://google.github.io/traceur-compiler/src/bootstrap.js&quot;&gt;&lt;/script&gt;&lt;script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$traceurRuntime.ModuleStore.getAnonymousModule(function() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &quot;use strict&quot;;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  var Calc = function Calc() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    console.log('Calc constructor');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  };</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  ($traceurRuntime.createClass)(Calc, {add: function(a, b) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return a + b;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }}, {});</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  var c = new Calc();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  console.log(c.add(4, 5));</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return {};});</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/script&gt;</span></div></div><div><br/></div><div>命令行转换</div><div><br/></div><div>作为命令行工具使用时，Traceur 是一个 Node 的模块，首先需要用 npm 安装。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ npm install -g traceur</span></div></div><div><br/></div><div>安装成功后，就可以在命令行下使用 Traceur 了。</div><div><br/></div><div>Traceur 直接运行 ES6 脚本文件，会在标准输出显示运行结果，以前面的calc.js为例。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ traceur calc.js</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Calc constructor</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">9</span></div></div><div><br/></div><div>如果要将 ES6 脚本转为 ES5 保存，要采用下面的写法。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ traceur --script calc.es6.js --out calc.es5.js</span></div></div><div><br/></div><div>上面代码的--script选项表示指定输入文件，--out选项表示指定输出文件。</div><div><br/></div><div>为了防止有些特性编译不成功，最好加上--experimental选项。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ traceur --script calc.es6.js --out calc.es5.js --experimental</span></div></div><div><br/></div><div>命令行下转换生成的文件，就可以直接放到浏览器中运行。</div><div><br/></div><div><br/></div><div>Node 环境的用法</div><div><br/></div><div>Traceur 的 Node 用法如下（假定已安装traceur模块）。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var traceur = require('traceur');var fs = require('fs');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// 将 ES6 脚本转为字符串</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var contents = fs.readFileSync('es6-file.js').toString();</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">var result = traceur.compile(contents, {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  filename: 'es6-file.js',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  sourceMap: true,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  // 其他设置</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  modules: 'commonjs'});</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">if (result.error)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  throw result.error;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// result 对象的 js 属性就是转换后的 ES5 代码</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">fs.writeFileSync('out.js', result.js);</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// sourceMap 属性对应 map 文件</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">fs.writeFileSync('out.js.map', result.sourceMap);</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 