<html>
<head>
  <title>1.02 -- 前端组件化</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1374"/>
<h1>1.02 -- 前端组件化</h1>

<div>
<span><div><div>很多课程一上来就给大家如何配置环境、怎么写 React.js 组件。但是本课程还是希望大家对问题的根源有一个更加深入的了解，其实很多的库、框架都是解决类似的问题。只有我们对这些库、框架解决的问题有深入的了解和思考以后，我们才能得心应手地使用它们，并且有新的框架出来也不会太过迷茫————因为其实它们解决都是同一个问题。</div><div><br/></div><div>这两节课我们来探讨一下是什么样的问题导致了我们需要前端页面进行组件化，前端页面的组件化需要解决什么样的问题。后续课程我们再来看看 React.js 是怎么解决这些问题的。</div><div><br/></div><div>所以这几节所讲的内容将和 React.js 的内容没有太大的关系，但是如果你能顺利了解这几节的内容，那么后面那些对新手来说很复杂的概念对你来说就是非常自然的事。</div><div><br/></div><div>一个简单的点赞功能</div><div><br/></div><div>我们会从一个简单的点赞功能讲起。 假设现在我们需要实现一个点赞、取消点赞的功能。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;body&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;div class='wrapper'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;button class='like-btn'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;span class='like-text'&gt;点赞&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;/body&gt;</span></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const button = document.querySelector('.like-btn')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const buttonText = button.querySelector('.like-text')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  let isLiked = false</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  button.addEventListener('click', () =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    isLiked = !isLiked</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if (isLiked) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      buttonText.innerHTML = '取消'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    } else {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      buttonText.innerHTML = '点赞'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }, false)</span></div></div><div><br/></div><div>功能和实现都很简单，按钮已经可以提供点赞和取消点赞的功能。这时候你的同事跑过来了，说他很喜欢你的按钮，他也想用你写的这个点赞功能。这时候问题就来了，你就会发现这种实现方式很致命：你的同事要把整个 button 和里面的结构复制过去，还有整段 JavaScript 代码也要复制过去。这样的实现方式没有任何可复用性。</div><div><br/></div><div>结构复用</div><div><br/></div><div>现在我们来重新来编写这个点赞功能, 让它具有一定的可复用性. 这次我们先写一个类, 这个类有 render 方法, 这个方法里面直接返回一个表示 HTML 结果的字符串:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class LikeButton {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;button id='like-btn'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span class='like-text'&gt;赞&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>然后可以用这个类来构建不同的点赞功能的实例, 然后把它们插到页面中.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const wrapper = document.querySelector('.wrapper')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const likeButton1 = new LikeButton()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  wrapper.innerHTML = likeButton1.render()</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const likeButton2 = new LikeButton()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  wrapper.innerHTML += likeButton2.render()</span></div></div><div><br/></div><div>这里非常暴力地使用了 innerHTML ，把两个按钮粗鲁地插入了 wrapper 当中。虽然你可能会对这种实现方式非常不满意，但我们还是勉强了实现了结构的复用。我们后面再来优化它。</div><div><br/></div><div>实现简单的组件化</div><div><br/></div><div>你一定会发现，现在的按钮是死的，你点击它它根本不会有什么反应。因为根本没有往上面添加事件。但是问题来了，LikeButton 类里面是虽然说有一个 button，但是这玩意根本就是在字符串里面的。你怎么能往一个字符串里面添加事件呢？DOM 事件的 API 只有 DOM 结构才能用。</div><div>我们需要 DOM 结构，准确地来说：我们需要这个点赞功能的 HTML 字符串表示的 DOM 结构。假设我们现在有一个函数 createDOMFromString ，你往这个函数传入 HTML 字符串，但是它会把相应的 DOM 元素返回给你。这个问题就可以解决了。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">// ::String =&gt; ::Document</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">const createDOMFromString = (domString) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const div = document.createElement('div')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  div.innerHTML = domString</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return div</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>先不用管这个函数应该怎么实现, 先知道它是干嘛的. 拿来用就好, 这时候用它来改写一下 LikeButton 类:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class LikeButton {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.el = createDOMFromString(`</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;button class='like-button'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span class='like-text'&gt;点赞&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      `)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.el.addEventListener('click', () =&gt; console.log('click'), false)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>现在 render() 返回的不是一个 html 字符串了，而是一个由这个 html 字符串所生成的 DOM。在返回 DOM 元素之前会先给这个 DOM 元素上添加事件再返回。</div><div>因为现在 render 返回的是 DOM 元素，所以不能用 innerHTML 暴力地插入 wrapper。而是要用 DOM API 插进去。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const wrapper = document.querySelector('.wrapper')</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const likeButton1 = new LikeButton()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  wrapper.appendChild(likeButton1.render())</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const likeButton2 = new LikeButton()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  wrapper.appendChild(likeButton2.render())</span></div></div><div><br/></div><div>现在你点击了这两个按钮, 每个按钮都会在控制台打印 click, 说明事件绑定成功了. 但是按钮上的文本还是没有发生变化, 只要稍微改动一下 LikeButton 的代码就可以完成完整的功能:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class LikeButton {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { isLiked: false }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    changeLikeText () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      const likeText = this.el.querySelector('.like-text')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state.isLiked = !this.state.isLiked</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      likeText.innerHTML = this.state.isLiked ? '取消' : '点赞'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.el = createDOMFromString(`</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;button class='like-button'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span class='like-text'&gt;点赞&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      `)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.el.addEventListener('click', this.changeLikeText.bind(this), false)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>这里的代码稍微长了一点, 但是还是很好理解.只不过是在给 LikeButton 类添加了构造函数, 这个构造函数会给每个 LikeButton 的实例添加一个对象 state, state 里面保存了每个按钮自己是否点赞的状态. 还改写了原来的事件绑定函数: 原来只打印 click, 现在点击的按钮会调用 changeLikeText 方法, 这个方法会根据 this.state 的状态改变点赞按钮的文本.</div><div><br/></div><div>现在这个组件的可复用性已经很不错了, 你的同事只要实例化以下然后插入到 DOM 里面就好了.</div><div><br/></div><div>看一下我们的代码, 仔细留意一下 changeLikeText 函数, 这个函数包含了 DOM 操作, 现在看起来比较简单, 那是因为我们只有一个 isLiked 状态, 由于数据状态改变会导致需要我们去更新页面的内容, 所以假想一下, 如果你的组件依赖了很多状态, 那么你的组件基本全部都是 DOM 操作.</div><div><br/></div><div>一个组件显示形态由多个状态决定的情况非常常见, 代码中混杂着对 DOM 的操作其实是一种很不好的实践, 手动管理数据和 DOM 之间的关系会导致代码的可维护性变差, 容易出错. 所以我们的例子还有优化的空间: 如何尽量减少这种手动 DOM 操作?</div><div><br/></div><div>改变状态 -&gt; 构建新的 DOM 元素更新页面</div><div><br/></div><div>这里要提出一种新的解决方案: 一旦状态发生改变, 就重新调用 render 方法, 构建一个新的 DOM 元素. 这样做的好处是什么? 好处是你可以在 render 方法里面使用最新的 this.state 来构造不同 HTML 结构的字符串, 并且通过这个字符串构造不同的 DOM 元素. 页面就更新了!</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class LikeButton {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.state = { isLiked: false }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  setState (state) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.state = state</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.el = this.render()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  changeLikeText () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.setState({</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      isLiked: !this.state.isLiked</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.el = createDOMFromString(`</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;button class='like-btn'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;span class='like-text'&gt;${this.state.isLiked ? '取消' : '点赞'}&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    `)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.el.addEventListener('click', this.changeLikeText.bind(this), false)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>其实只改动了几个小地方:</div><ol><li><div>render 函数里面的 HTML 字符串会根据 this.state 不同而不同 (这里用了 ES6 的末班字符串, 做这种事很方便)</div></li><li><div>新增一个 setState, 这个函数接收一个对象作为参数; 它会设置实例的 state, 然后重新调用一下 render 方法.</div></li><li><div>当用户点击按钮的时候, changeLikeText 会构建新的 state 对象, 这个新的 state, 传入 setState 函数当中.</div></li></ol><div><br/></div><div>这样的结果就是, 用户每次点击, changeLikeText 都会改变组件状态然后调用 setState, setState 会调用 render, render 方法会根据 state 的不同重新构建不同的 DOM 元素.</div><div><br/></div><div>也就是说, 你只要调用 setState, 组件就会重新渲染. 我们顺利消除了手动的 DOM 操作.</div><div><br/></div><div>重新插入新的 DOM 元素</div><div><br/></div><div>上面的改进不会有什么效果, 因为你仔细看一下会发现, 其实重新渲染的 DOM 元素并没有插入到页面当中. 所以在这个组件外面, 你需要知道这个组件发生了改变, 并把新的 DOM 元素更新到页面当中.</div><div><br/></div><div>重新修改一下 setState 方法</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    setState (state) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      const oldEl = this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = state</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.el = this.render()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      if (this.onStateChange) this.onStateChange(oldEl, this.el)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>使用这个组件的时候:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">const likeButton = new LikeButton()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">wrapper.appendChild(likeButton.render()) // 第一次插入 DOM 元素</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">likeButton.onStateChange = (oldEl, newEl) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  wrapper.insertBefore(newEl, oldEl) // 插入新的元素</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  wrapper.removeChild(oldEl) // 删除旧的元素</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>这里每次 setState 都会调用 onStateChange 方法, 而这个方法是实例化以后时候被设置的, 所以你可以自定义 onStateChange 的行为.</div><div>这里做的事是, 每当 setState 中构造完新的 DOM 元素后, 就会通过 setStateChange 告知外部插入新的 DOM 元素, 然后删除旧的元素, 页面就更新了. 这里已经做了进一步的优化了: 现在不需要再动手更新页面了.</div><div><br/></div><div>非一般的暴力, 因为每次 setState 都重新构造, 新增, 删除 DOM 元素, 会导致浏览器进行大量的重排, 严重影响性能. 不过没关系, 这种暴力行为可以被一种 Virtual-DOM 的策略规避掉, 但这不是本文讨论的范围.</div><div><br/></div><div>这个版本的点赞功能跟不错, 我们可以继续在上面加功能, 而且还不需要手动操作 DOM. 但是有一个不好的地方, 如果我需要重新另外做一个新组件, 譬如说评论组件, 那么里面的这些setState 方法要重新写一遍, 其实这些东西都是可以抽出来的, 变成一个通用的模式.</div><div><br/></div><div>为了让代码更加灵活, 可以写更多的组件, 我们把这种模式抽象出来, 放到一个 Component 类当中:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    setState (state) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      const oldEl = this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = state</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this._renderDOM()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      if (this.onStateChange) this.onStateChange(oldEl, this.el)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    _renderDOM () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.el = createDOMFromString(this.render())</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      if (this.onClick) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.el.addEventListener('click', this.onClick.bind(this), false)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>这个是一个组件父类 Component, 所有组件都可以继承这个父类来构建. 它定义的两个方法, 一个是我们已经很熟悉的 setState; 一个是私有方法 _renderDOM. _renderDOM 方法调用 this.render 来构建 DOM 元素并且监听 onClick 事件. 所以, 组件子类继承的时候只需要实现一个返回 HTML 字符串的 render 方法就可以了.</div><div><br/></div><div>还有一个额外的 mount 方法, 其实就是把组件的 DOM 元素插入到页面, 并且在 setState 的时候更新页面:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  const mount = (component, wrapper) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    wrapper.appendChild(component._renderDOM())</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    component.onStateChange = (oldEl, newEl) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      wrapper.insertBefore(newEl, oldEl)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      wrapper.removeChild(oldEl)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>这样的话我们重新写点赞组件就会变成:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class LikeButton extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { isLiked: false }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    onClick () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.setState({</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        isLiked: !this.state.isLiked</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;button class='like-btn'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span class='like-text'&gt;${this.state.isLiked ? '取消' : '点赞'}&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  mount(new LikeButton(), wrapper)</span></div></div><div><br/></div><div>这样还不够好, 在实际开发中, 你可能需要给组件传入一些自定义的配置数据. 例如说想配置一下点赞按钮的背景颜色, 如果我给它传入一个参数, 告诉它怎么设置自己的颜色. 那么这个按钮的定制性就更强了. 所以我们可以给组件类和它的子类都传入一个参数 props, 作为组件的排至参数, 修改 Component 的构造函数为:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor (props = {}) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.props = props</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>继承的时候通过 super(props) 把 props 传给父类, 这样就可以通过 this.props 获取到配置参数:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class LikeButton extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { isLiked: false }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    onClick () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.setState({</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        isLiked: !this.state.isLiked</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;button class='like-btn' style=&quot;background-color: ${this.props.bgColor}&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span class='like-text'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            ${this.state.isLiked ? '取消' : '点赞'}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  mount(new LikeButton({ bgColor: 'red' }), wrapper)</span></div></div><div><br/></div><div>这里我们稍微修改一下原有的 LikeButton 的 render 方法, 让它可以根据传入参数 this.props.bgColor 来生成不同的 style 属性. 这样就可以自有配置组件的颜色了.</div><div><br/></div><div>只要有上面那个 Component 类和 mount 方法加起来不足 40 行代码就可以做到组件化. 如果我们需要写另外一个组件, 只需要像上面一样, 简单的继承一下 Component 类就好了:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class RedBlueButton extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        color: 'red'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    onClick () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.setState({</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        color: 'blue'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;div style='color: ${this.state.color};'&gt;${this.state.color}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>简单好用, Component 完整代码如下</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;!DOCTYPE html&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;html&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;head&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;meta charset=&quot;utf-8&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;title&gt;Reactjs in 40 &lt;/title&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;style media=&quot;screen&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      .like-btn { font-size: 50px; }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;/style&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;/head&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;body&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &lt;div class='wrapper'&gt;&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;/body&gt;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;script type=&quot;text/javascript&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /* Component */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    class Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      constructor (props = {}) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.props = props</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      setState (state) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        const oldEl = this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.state = state</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.el = this.renderDOM()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (this.onStateChange) this.onStateChange(oldEl, this.el)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      renderDOM () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.el = createDOMFromString(this.render())</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        if (this.onClick) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          this.el.addEventListener('click', this.onClick.bind(this), false)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return this.el</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const createDOMFromString = (domString) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      const div = document.createElement('div')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      div.innerHTML = domString</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return div</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const mount = (component, wrapper) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      wrapper.appendChild(component.renderDOM())</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      component.onStateChange = (oldEl, newEl) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        wrapper.insertBefore(newEl, oldEl)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        wrapper.removeChild(oldEl)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /* ========================================= */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    class LikeButton extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.state = { isLiked: false }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      onClick () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          isLiked: !this.state.isLiked</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;button class='like-btn' style=&quot;background-color: ${this.props.bgColor}&quot;&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;span class='like-text'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">              ${this.state.isLiked ? '取消' : '点赞'}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &lt;span&gt;👍&lt;/span&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;/button&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    class RedBlueButton extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.state = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          color: 'red'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      onClick () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          color: 'blue'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        return `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          &lt;div style='color: ${this.state.color};'&gt;${this.state.color}&lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        `</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const wrapper = document.querySelector('.wrapper')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    mount(new LikeButton({ bgColor: 'red' }), wrapper)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    mount(new LikeButton(), wrapper)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    mount(new RedBlueButton(), wrapper)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  &lt;/script&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;/html&gt;</span></div></div><div><br/></div><div>我们用很长的篇幅来讲这个例子, 并且在这个过程中一直在优化编写的方式. 最后抽离出来了一个类, 可以帮助我们更好的做组件化. 在这个过程中我们学到了什么?</div><div><br/></div><div>组件化可以帮助我们解决前端的复用性问题, 整个页面可以由这样的不同的组件组合, 嵌套构成.</div><div><br/></div><div>一个组件有自己的显示形态 (上面的 HTML 结构和内容) 行为, 组件的显示形态和行为可以由数据状态 (state) 和配置参数 (props) 共同决定. 数据状态和配置参数的改变都会影响到这个组件的显示形态.</div><div><br/></div><div>当数据变化的时候, 组件的显示需要更新. 所以如果组件化的模式能提供一种高效的方式自动化地帮助我们更新页面, 那也就可以大大降低我们代码的复杂度, 带来更好的可维护性.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 