<html>
<head>
  <title>3.01 -- 高阶组件 (Higher-Order Component)</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1347"/>
<h1>3.01 -- 高阶组件 (Higher-Order Component)</h1>

<div>
<span><div>有时候人们很喜欢造一下名字很吓人的名词, 但是其实很简单.</div><div><br/></div><div>高阶组件是一个概念上很简单, 但是却非常常用, 非常实用的东西, 被大量 React.js 相关的第三方库频繁使用, 在前端的业务开发中, 你不掌握高阶组件其实也可以完成项目的开发, 但是如果能灵活运用, 可以让你的代码更加的优雅, 复用性, 灵活性更强. 它是一个加分项, 而且加的不少.</div><div><br/></div><div>什么是高阶组件</div><div><br/></div><div>高阶组件就是一个函数, 传给它一个组件, 它返回一个新的组件</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">const NewComponent = higherOrderComponent(OldComponent)</span></div></div><div><br/></div><div>重要的事在重复一次, 高阶组件是一个函数 (而不是组件), 它接受一个组件作为参数, 返回一个新的组件. 而这个新的组件会使用你传给他的组件作为子组件, 我们看看一个很简单的高阶组件:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component } from 'react'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default (WrappedComponent) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class NewComponent extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    // 可以做很多自定义逻辑</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return &lt;WrappedComponent /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return NewComponent</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><br/></div><div>现在看来好像什么用都没有, 它就是简单的构建了一个新的组件类 NewComponent, 然后把传进去的 WrapperComponent 渲染出来. 但是我们可以给 NewComponent 做一些数据启动工作:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component } from 'react'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default (WrappedComponent, name) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class NewComponent extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { data: null }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      let data = localStorage.getItem(name)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.setState({ data })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return &lt;WrappedComponent data={this.state.data} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return NewComponent</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>现在 NewComponent 会根据第二个参数 name 在挂载阶段从 LocalStorage 加载数据, 并且 setState 到自己的 state.data 中, 而渲染的时候将 state.data 通过 props.data 传给 WrapperComponent.</div><div><br/></div><div>这个高阶组件有什么用呢? 假设上面的代码是在 src/wrapWithLoadData.js 文件中的, 我们可以在别的地方这么用它:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithLoadData from './wrapWithLoadData'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class InputWithUserName extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return &lt;input value={this.props.data} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">InputWithUserName = wrapWithLoadData(InputWithUserName, 'username')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default InputWithUserName</span></div></div><div><br/></div><div>假如 InputWithUserName 的功能需求是挂载的时候从 LocalStorage 里面加载 username 字段作为 &lt;input /&gt; 的 value 值, 现在有了 wrapWithLoadData, 我们可以很容易地做到这件事情.</div><div><br/></div><div>只需要定义一个非常简单的 InputWithUserName, 它就会把 props.data 作为 &lt;input /&gt; 的 value 值. 然后把这个组件和 'username' 传给 wrapWithLoadData, wrapWithLoadData 会返回一个新的组件, 我们用这个新的组件覆盖原来的 InputWithUserName, 然后再导出新的模块.</div><div><br/></div><div>别人用这个组件的时候实际是用了被加工过的组件:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import InputWithUserName from './InputWithUserName'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Index extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        用户名：&lt;InputWithUserName /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>根据 wrapWithLoadData 的代码我们可以知道, 这个新的组件挂载的时候会先去 LocalStorage 加载数据, 渲染的时候再通过 peops.data 传给真正的 InputWithUserName.</div><div><br/></div><div>如果现在我们需要另外一个文本输入框组件, 它也需要 LocalStorage 加载 'content' 字段的数据, 我们只需要定义一个新的 TextareaWithContent:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithLoadData from './wrapWithLoadData'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class TextareaWithContent extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return &lt;textarea value={this.props.data} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">TextareaWithContent = wrapWithLoadData(TextareaWithContent, 'content')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default TextareaWithContent</span></div></div><div><br/></div><div>写起来非常的轻松, 我们根本不需要重复写从 LocalStorage 加载数据字段的逻辑, 直接用 wrapWithLoadData 包装一下就可以了.</div><div><br/></div><div>我们来回顾一下, 对于 InputWithUserName 和 TextareaWithContent 这两个组件来说, 它们的需求有着这么一个相同的逻辑: &quot;挂载阶段从 LocalStorage 中加载特定字段数据&quot;</div><div><br/></div><div>如果按照之前的做法, 我们需要给它们两个都加上 componentWillMount 生命周期, 然后在里面调用 LocalStorage. 要是有第三个组件也有这样的加载逻辑, 我又得重写一遍逻辑, 但有了 wrapWithLoadData 高阶组件, 我们把这样的逻辑用一个组件包裹了起来, 并且通过给高阶组件传入 name 来达到不同字段的数据加载, 充分复用了逻辑代码.</div><div><br/></div><div>到这里, 高阶组件的作用其实不言而喻, 其实就是为了组件之间的代码复用. 组件可能有着某些相同的逻辑, 把这些逻辑抽离出来, 放到高阶组件中进行复用. 高阶组件内部的包装组件和被包装组件之间通过 props 传递数据.</div><div><br/></div><div>高阶组件的灵活性</div><div><br/></div><div>代码复用的方法, 形式有很多种, 你可以用类继承来做代码复用, 也可以分离模块的方式, 但是高阶组件这种方式很有意思, 也很灵活. 学过设计模式的同学应该能反应过来, 它其实就是设计模式里面的装饰者模式. 他通过组合的方式达到很高的灵活程度.</div><div><br/></div><div>假设我们现在的需求改变了. 现在要的是通过 Ajax 加载数据而不是从 LocalStorage 加载数据. 我们只需要新建一个 wrapWithAjaxData 高阶组件:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component } from 'react'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default (WrappedComponent, name) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class NewComponent extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { data: null }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      ajax.get('/data/' + name, (data) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({ data })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return &lt;WrappedComponent data={this.state.data} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return NewComponent</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>其实就是改了一下 wrapWithLoadData 的 componentWillMount 中的逻辑, 改成了从服务器加载数据, 现在只需要把 InputWithUserName 稍微改一下:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithAjaxData from './wrapWithAjaxData'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class InputWithUserName extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return &lt;input value={this.props.data} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">InputWithUserName = wrapWithAjaxData(InputWithUserName, 'username')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default InputWithUserName</span></div></div><div><br/></div><div>只要改一下包装的高阶组件就可以到达需要的效果. 而且我们并没有改动 InputWithUserName 组件内部的任何逻辑, 也咩有改动 Index 的任何逻辑, 只是改动了中间的高阶组件函数.</div><div><br/></div><div>多层高阶组件</div><div><br/></div><div>假如现在需求有变化了: 我们需要先从 LocalStorage 中加载数据, 再用这个数据去服务器取数据. 我们改一下 (或者新建一个) wrapWithAjaxData 高阶组件, 修改其中的 componentWillMount:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      ajax.get('/data/' + this.props.data, (data) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({ data })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">...</span></div></div><div><br/></div><div>它会用传进来的 props.data 去服务器取数据. 这时候修改 InpputWithUserName:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithLoadData from './wrapWithLoadData'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithAjaxData from './wrapWithAjaxData'</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class InputWithUserName extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return &lt;input value={this.props.data} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">InputWithUserName = wrapWithAjaxData(InputWithUserName)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">InputWithUserName = wrapWithLoadData(InputWithUserName, 'username')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default InputWithUserName</span></div></div><div><br/></div><div>大家可以看到, 我们给 InputWithUserName 应用了两种高阶组件: 先用 wrapWithAjaxData 包裹 InputWithUserName, 再用 wrapWithLoadData 包含上次包裹的结果. 他们之间的关系如下图:</div><div><br/></div><div><img src="3.01 -- 高阶组件 (Higher-Order Component)_files/Image.png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>实际上最终得到的组件会先去 LocalStorage 取数据, 然后通过 props.data 传给下一层组件, 下一层用这个 props.data 通过 Ajax 去服务端取数据, 然后再通过 props.data 把数据传给下一层, 也就是 InputWithUserName. 体会一下这个数据流向:</div><div><br/></div><div><img src="3.01 -- 高阶组件 (Higher-Order Component)_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div><br/></div><div>用高阶组件改造评论功能 (选读)</div><div><br/></div><div>大家对这种在挂载从 LocalStorage 加载数据的模式都很熟悉, 在上一阶段实战中, CommentInput 和 CommentApp 都用了这种方式加载, 保存数据. 实际上我们可以构建一个高阶组件把它们相同的逻辑抽离出来, 构建一个高阶组件 wrapWithLoadData:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default (WrappedComponent, name) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class LocalStorageActions extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { data: null }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      let data = localStorage.getItem(name)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      try {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        // 尝试把它解析成 JSON 对象</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({ data: JSON.parse(data) })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      } catch (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        // 如果出错了就当普通字符串读取</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({ data })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    saveData (data) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      try {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        // 尝试把它解析成 JSON 字符串</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        localStorage.setItem(name, JSON.stringify(data))</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      } catch (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        // 如果出错了就当普通字符串保存</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        localStorage.setItem(name, `${data}`)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;WrappedComponent</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          data={this.state.data}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          saveData={this.saveData.bind(this)}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          // 这里的意思是把其他的参数原封不动地传递给被包装的组件</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          {...this.props} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return LocalStorageActions</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div>commentApp 可以这样使用:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class CommentApp extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  static propTypes = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    data: PropTypes.any,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    saveData: PropTypes.func.isRequired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.state = { comments: props.data }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleSubmitComment (comment) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if (!comment) return</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if (!comment.username) return alert('请输入用户名')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if (!comment.content) return alert('请输入评论内容')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const comments =</span> <a href="http://this.state.comments/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">this.state.comments</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    comments.push(comment)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.setState({ comments })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.props.saveData(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  handleDeleteComment (index) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const comments =</span> <a href="http://this.state.comments/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">this.state.comments</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    comments.splice(index, 1)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.setState({ comments })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.props.saveData(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  render() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;div className='wrapper'&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;CommentInput onSubmit={this.handleSubmitComment.bind(this)} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;CommentList</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          comments={</span><a href="http://this.state.comments/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">this.state.comments</a><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          onDeleteComment={this.handleDeleteComment.bind(this)} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      &lt;/div&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CommentApp = wrapWithLoadData(CommentApp, 'comments')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default CommentApp</span></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>同样地可以在 CommentInput 中使用 wrapWithloadData, </div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">comment-app2/src/CommentApp.js</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@@ -1,29 +1,17 @@</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component } from 'react'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component, PropTypes } from 'react'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import CommentInput from './CommentInput'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import CommentList from './CommentList'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithLoadData from './wrapWithLoadData'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class CommentApp extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.state = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      comments: <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">props.data || </span>[]</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  static propTypes = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    data: PropTypes.any,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    saveData: PropTypes.func.isRequired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this._loadComments()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   _loadComments () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    let comments = localStorage.getItem('comments')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if (comments) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      comments = JSON.parse(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.setState({ comments })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   _saveComments (comments) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    localStorage.setItem('comments', JSON.stringify(comments))</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.state = { comments: props.data }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   handleSubmitComment (comment) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@@ -33,14 +21,14 @@ class CommentApp extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const comments =</span> <a href="http://this.state.comments/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">this.state.comments</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    comments.push(comment)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.setState({ comments })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this._saveComments(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.props.saveData(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   handleDeleteComment (index) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const comments =</span> <a href="http://this.state.comments/" style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">this.state.comments</a></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    comments.splice(index, 1)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.setState({ comments })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this._saveComments(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.props.saveData(comments)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   render() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@@ -55,4 +43,5 @@ class CommentApp extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CommentApp = wrapWithLoadData(CommentApp, 'comments')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default CommentApp</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">29  comment-app2/src/CommentInput.js</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@@ -1,39 +1,27 @@</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component, PropTypes } from 'react'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import wrapWithLoadData from './wrapWithLoadData'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class CommentInput extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  static propTypes = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    onSubmit: PropTypes.func</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    onSubmit: PropTypes.func,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    data: PropTypes.any,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    saveData: PropTypes.func.isRequired</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  constructor (props) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    super(props)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.state = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      username: '',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      username: props.data,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      content: ''</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this._loadUsername()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   componentDidMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.textarea.focus()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   _loadUsername () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const username = localStorage.getItem('username')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if (username) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.setState({ username })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   _saveUsername (username) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    localStorage.setItem('username', username)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   handleUsernameBlur (event) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this._saveUsername(event.target.value)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    this.props.saveData(event.target.value)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">   handleUsernameChange (event) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@@ -91,4 +79,5 @@ class CommentInput extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CommentInput = wrapWithLoadData(CommentInput, 'username')</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default CommentInput</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  </span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">37  comment-app2/src/wrapWithLoadData.js</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">@@ -0,0 +1,37 @@</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">import React, { Component } from 'react'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">export default (WrappedComponent, name) =&gt; {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  class LocalStorageActions extends Component {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    constructor () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      super()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      this.state = { data: null }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     componentWillMount () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      let data = localStorage.getItem(name)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      try {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({ data: JSON.parse(data) })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      } catch (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        this.setState({ data })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     saveData (data) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      try {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        localStorage.setItem(name, JSON.stringify(data))</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      } catch (e) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        localStorage.setItem(name, `${data}`)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     render () {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      return (</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &lt;WrappedComponent</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          data={this.state.data}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          saveData={this.saveData.bind(this)}</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          {...this.props} /&gt;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  return LocalStorageActions</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><br/></div><div>总结 </div><div><br/></div><div>高阶组件就是一个函数, 传给它一个组件, 它返回一个新的组件. 新的组件使用传入的组件作为子组件.</div><div><br/></div><div>高阶组件的作用是用于代码复用, 可以把组件之间可复用的代码, 逻辑抽离到高阶组件当中. 新的组件和传入的组件通过 props 传递信息.</div><div><br/></div><div>高阶组件有助于提高我们代码的灵活性, 逻辑的复用性. 灵活和熟练地掌握高阶组件的用法需要经验的积累还有长时间的思考和练习, 如果你觉得本章节内容无法完全消化和掌握也没关系, 可以简单了解高阶组件的定义, 形式和作用即可.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 