<html>
<head>
  <title>3.1 -- 创建分类</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1660"/>
<h1>3.1 -- 创建分类</h1>

<div>
<span><div><div><span style="font-weight: bold;">说明</span></div><div><br/></div><div>在我们开发报修系统之前, 需要准备好报修分类, 因为每一份报修信息都必须发布在某个分类下面, 然后相应的报修队伍会进行接手, 报修信息依赖于分类.</div><div><br/></div><div>报修信息包括:</div><ol><li><div>报修时间戳 ( 创建时间 + 更新时间 )</div></li><li><div>报修所在分类 ( 六大分类 )</div></li><li><div>报修所在地点 ( 所在小区 + 所在建筑区域 )</div></li><li><div>报修详细地址 text</div></li><li><div>报修具体物件</div></li><li><div>报修详细描述 text</div></li><li><div>备注 text</div></li><li><div>报修状态 ( 四种状态 )</div></li></ol><div><br/></div><div>所以在创建报修信息之前, 先创建报修种类, 报修校区, 校区建筑物, </div><div>不可能存在校区建筑物范围之外的报修场所</div><div><br/></div><div>校区在未来可能存在变动, 而报修种类总是不变的.</div><div><br/></div><div>我们将会为此项目创建以下几个分类(Categories):</div><ol><li><div>Appliances &amp; Fittings(小型家用电器及配件)</div></li><li><div>Electrical fittings (大型电气设备)</div></li><li><div>External (外观墙体)</div></li><li><div>Furniture &amp; Fittings (家具及配件)</div></li><li><div>Plumbing (水暖设备)</div></li><li><div>Safety (安全设备, 门锁)</div></li></ol><div><br/></div><div><span style="font-weight: bold;">数据模型</span></div><div><br/></div><div>我们需要创建『分类模型（Model）』来跟数据库进行交互，创建的命令很简单。但请记住，所有我们新建的模型文件都要统一放置在 app/Models 文件夹下，为此我们在创建一个新的模型对象时，需要在模型名称前面加上 Models 目录。</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">$ php artisan make:model Models/Category -m</span></div></div><div><br/></div><div>-m 选项意为顺便创建数据库迁移文件（Migration）。使用 git status 查看文件创建状态：</div><div><br/></div><div><span style="font-weight: bold;">1.迁移数据库 </span></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Support\Facades\Schema;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Database\Schema\Blueprint;</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Database\Migrations\Migration;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class CreateCategoriesTable extends Migration</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * Run the migrations.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     *</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * @return void</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function up()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Schema::create('categories', function (Blueprint $table) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;increments('id');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;string('name')-&gt;index()-&gt;comment('名称');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;text('description')-&gt;nullable()-&gt;comment('描述');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;integer('maintanence_count')-&gt;default(0)-&gt;comment('报修数量');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            $table-&gt;timestamps();</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        });</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    /**</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * Reverse the migrations.</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     *</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     * @return void</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">     */</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    public function down()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        Schema::dropIfExists('categories');</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><br/></div><div><span style="font-weight: bold;">2.数据模型</span></div><div><br/></div><div>当我们创建完数据模型之后, 都需要设置 Category 的 $fillable 属性</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">&lt;?php</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">namespace App\Models;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">use Illuminate\Database\Eloquent\Model;</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">class Category extends Model</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">{</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    protected $fillable = [</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        'name', 'description',</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    ];</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><br/></div><div><span style="font-weight: bold;">3.初始化分类数据</span></div><div><br/></div><div>我们想项目在安装的时候, 就已经有初始数据存在.</div><div>面对数据库内容填充的需求, 一般情况下我们会使用 数据填充 Seed , 可是在当下场景中, 我们无法使用该功能, 这个功能一般是用来生成假数据, 而我们现在需要生成的是项目的初始化数据. 这些数据时项目运行的一部分, 在生产环境下也会使用到, 而数据填充只能在开发时使用.</div><div><br/></div><div>数据迁移是一个不错的解决方案. 功能定位上, 数据迁移也是项目的一部分, 执行时间正好是项目安装过程中, 并且执行按照先后顺序, 确保了初始化数据发生在数据表结构创建完成后.</div><div><br/></div><div>接下来让我们生成数据库迁移文件, 作为 初始化数据 的迁移文件, 我们定义为 seed_(数据库表名)_data</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$php artisan make:migration seed_categories_data</div></div><div><br/></div><div><br/></div><div><b>Git 版本控制</b></div><div><b><br/></b></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>$ git add -A</div><div>$ git commit -m &quot;Create categories&quot;</div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 