<html>
<head>
  <title>1 -- 变量声明 const 和 let</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600363 (zh-CN, DDL); Windows/6.1.1 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1402"/>
<h1>1 -- 变量声明 const 和 let</h1>

<div>
<span><div><div>变量声明const和let</div><div><br/></div><div>在 ES6 之前, 我们都是用 var 关键字声明变量. 无论声明在何处, 都会被视为声明在函数的最顶部 (不在函数内即在全局作用域的最顶部). 这就是函数变量提升. 例如:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  function aa() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if(flag) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        var test = 'hello man'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    } else {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        console.log(test)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>以上的代码实际上是:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">function aa() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var test // 变量提升，函数最顶部</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if(flag) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        test = 'hello man'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    } else {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //此处访问 test 值为 undefined</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        console.log(test)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    //此处访问 test 值为 undefined</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>所以不用关心 flag 是否为 true or false. 实际上, 无论如何 test 都会被创建声明.</div><div><br/></div><div>接下来 ES6 主角登场:</div><div>我们通常用 let 和 const 来声明, let 表示变量, const 表示常量. let 和 const 都是块级作用域. 块级作用域:</div><ul><li><div>在一个函数内部</div></li><li><div>在一个代码块内部</div></li></ul><div><br/></div><div>说白了只要在{}花括号内的代码块即可认为 let 和 const 的作用域.</div><div><br/></div><div>看以下代码:</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  function aa() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    if(flag) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">       let test = 'hello man'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    } else {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        //test 在此处访问不到</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        console.log(test)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  }</span></div></div><div><br/></div><div>let 的作用域是在它所在当前代码块, 但不会被提升到前函数的最顶部.</div><div><br/></div><div>再来说说 const</div><div>const 声明的变量必须提供一个值, 而且会被认为是常量, 意思是它的值被设置完成后就不能修改了.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const name = 'lux'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    name = 'joe' // 再次赋值此时会报错</span></div></div><div><br/></div><div>还有, 如果 const 的是一个对象, 对象所包含的值是可以被修改的. 抽象一点儿说, 就是对象所指向的地址不能改变, 而变量成员是可以修改的.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const student = { name: 'cc' }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    // 没毛病</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    student.name = 'yy'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    // 如果这样子就会报错了</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    student  = { name: 'yy' }</span></div></div><div><br/></div><div>说说 TDZ (暂时性死区), 想必你早有耳闻.</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        console.log(value) // 报错</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        let value = 'lala'</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div></div><div><br/></div><div><br/></div><div>我们都知道, JS 引擎扫描代码时, 如果发现变量声明, 用 var 声明变量时会将声明提升到函数或全局作用域的顶部. 但是 let 或者 const, 会将声明关进一个小黑屋被放出啦, 才能安全使用这个变量.</div><div><br/></div><div>说一道面试题</div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">  var funcs = []</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    for (var i = 0; i &lt; 10; i++) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        funcs.push(function() { console.log(i) })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    funcs.forEach(function(func) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        func()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    })</span></div></div><div><br/></div><div>输出十次10</div><div>但是如果想要输出 0 到 9 </div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    // ES5知识，我们可以利用“立即调用函数”解决这个问题</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    var funcs = []</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    for (var i = 0; i &lt; 10; i++) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        funcs.push(</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">          (function(value) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            return function() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                console.log(value)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        })(i)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">      )</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    funcs.forEach(function(func) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        func()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    })</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div></div><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    // 再来看看es6怎么处理的</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    const funcs = []</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    for (let i = 0; i &lt; 10; i++) {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        funcs.push(function() {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            console.log(i)</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        })</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    funcs.forEach(func =&gt; func())</span></div></div><div><br/></div><div>达到相同的效果, ES6 显然更加漂亮.</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 